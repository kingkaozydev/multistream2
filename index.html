<!DOCTYPE html><html lang="pt-PT"><head><meta charset="UTF-8"><title>MultLives - Assista Múltiplas Lives (Twitch, Kick, YouTube)</title><meta name="description" content="A melhor plataforma para acompanhar várias lives ao mesmo tempo. Assista Twitch, Kick e YouTube simultaneamente. Ideal para eventos!"><meta name="keywords" content="multlives, nevethon, multitwitch, multikick, ver varias lives ao mesmo tempo, subathon tracker, multi stream player"><meta name="author" content="KaozyKing"><meta name="copyright" content="© 2024 KaozyKing. Todos os direitos reservados. Código proprietário."><link rel="canonical" href="https://multlives.vercel.app/"><meta property="og:type" content="website"><meta property="og:url" content="https://multlives.vercel.app/"><meta property="og:title" content="MultLives - Assista Múltiplas Lives Simultaneamente"><meta property="og:description" content="Acompanhe seus streamers favoritos da Twitch, Kick e YouTube em uma única tela. Personalizável, rápido e gratuito."><meta property="og:image" content="https://multlives.vercel.app/og-image.png"><meta property="twitter:card" content="summary_large_image"><meta property="twitter:title" content="MultLives - Player de Múltiplas Lives"><meta property="twitter:description" content="Plataforma definitiva para assistir múltiplas streams. Twitch, Kick e YT em um só lugar."><meta property="twitter:image" content="https://multlives.vercel.app/og-image.png"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"><meta name="referrer" content="strict-origin-when-cross-origin"><link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none'><path d='M5 19V5' stroke='white' stroke-width='3' stroke-linecap='round' /><path d='M19 19V5' stroke='white' stroke-width='3' stroke-linecap='round' /><path d='M19 19V5' stroke='white' stroke-width='3' stroke-linecap='round' /><path d='M5 5L12 13L19 5' stroke='%23a5f3fc' stroke-width='3' stroke-linecap='round' stroke-linejoin='round' /></svg>"><script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script><script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script><script src="https://unpkg.com/@babel/standalone/babel.min.js"></script><script src="https://cdn.tailwindcss.com"></script><script type="module">import{inject}from'https://esm.sh/@vercel/analytics';inject({mode:'production',debug:false});console.log("Vercel Analytics Injected");</script><link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=Inter:wght@400;900&family=Russo+One&family=Share+Tech+Mono&display=swap" rel="stylesheet"><script>tailwind.config={theme:{extend:{fontFamily:{sans:['"Plus Jakarta Sans"','sans-serif'],display:['"Inter"','sans-serif'],russo:['"Russo One"','sans-serif'],mono:['"Share Tech Mono"','monospace']},colors:{background:'#09090b',surface:'#121215',surfaceHighlight:'#1e1e24',accent:'#6366f1',accentHover:'#4f46e5',ice:'#a5f3fc',kick:'#53fc18',kickDark:'#0b0e11',offline:'#1a1a1a'},animation:{'spin-slow':'spin 3s linear infinite','aurora-1':'aurora 20s infinite alternate','aurora-2':'aurora 25s infinite alternate-reverse','audio-pulse-slow':'audioPulse 8s ease-in-out infinite','audio-pulse-fast':'audioPulse 5s ease-in-out infinite alternate','toast-in':'toastIn 0.3s cubic-bezier(0.16, 1, 0.3, 1)','slide-up':'slideUp 0.3s ease-out forwards','rattle':'rattle 0.1s linear infinite','drive-fast':'driveFast 0.8s cubic-bezier(0.2, 0.8, 0.2, 1) forwards','drive-slow':'driveSlow 2s cubic-bezier(0.4, 0, 1, 1) forwards','smoke-puff':'smokePuff 1s ease-out infinite','speed-lines':'speedLines 0.5s linear infinite','pulse-glow':'pulseGlow 2s ease-in-out infinite','pulse-fast':'pulseFast 0.5s ease-in-out infinite','heart-beat':'heartBeat 1.5s infinite','blizzard-fast':'blizzard 2s linear infinite','blizzard-slow':'blizzard 5s linear infinite','fade-in':'fadeIn 0.5s ease-out forwards','music-bar':'musicBar 1s ease-in-out infinite','pulse-border':'pulseBorder 1.5s infinite','snow-shake':'snowShake 0.2s linear infinite'},keyframes:{aurora:{'0%':{transform:'translate(0, 0) rotate(0deg)'},'100%':{transform:'translate(10%, 10%) rotate(10deg)'}},audioPulse:{'0%, 100%':{opacity:'0.2',transform:'scale(1)'},'50%':{opacity:'0.5',transform:'scale(1.15)'}},toastIn:{'0%':{transform:'translateX(100%)',opacity:'0'},'100%':{transform:'translateX(0)',opacity:'1'}},slideUp:{'0%':{transform:'translateY(100%)',opacity:'0'},'100%':{transform:'translateY(0)',opacity:'1'}},rattle:{'0%, 100%':{transform:'translate(0, 0) rotate(0deg)'},'25%':{transform:'translate(-1px, 1px) rotate(-1deg)'},'75%':{transform:'translate(1px, -1px) rotate(1deg)'}},driveFast:{'0%':{transform:'translateX(-200%) skewX(10deg)',opacity:'0'},'100%':{transform:'translateX(0) skewX(0deg)',opacity:'1'}},driveSlow:{'0%':{transform:'translateX(-150%)',opacity:'0'},'20%':{transform:'translateX(-100%)',opacity:'1'},'100%':{transform:'translateX(0)',opacity:'1'}},smokePuff:{'0%':{transform:'translate(0, 0) scale(0.5)',opacity:'0.8'},'100%':{transform:'translate(-10px, -20px) scale(2)',opacity:'0'}},speedLines:{'0%':{transform:'translateX(100%)',opacity:'0'},'50%':{opacity:'0.5'},'100%':{transform:'translateX(-100%)',opacity:'0'}},pulseGlow:{'0%, 100%':{opacity:'0.6',filter:'brightness(1)'},'50%':{opacity:'1',filter:'brightness(1.5) blur(1px)'}},pulseFast:{'0%, 100%':{opacity:'0.8',transform:'scale(1)'},'50%':{opacity:'1',transform:'scale(1.05)',filter:'brightness(1.5) drop-shadow(0 0 10px cyan)'}},heartBeat:{'0%':{transform:'scale(1)'},'14%':{transform:'scale(1.3)'},'28%':{transform:'scale(1)'},'42%':{transform:'scale(1.3)'},'70%':{transform:'scale(1)'}},blizzard:{'0%':{transform:'translate(0, 0) rotate(0deg)'},'100%':{transform:'translate(-20px, 100vh) rotate(360deg)'}},fadeIn:{'0%':{opacity:'0',transform:'translateY(10px)'},'100%':{opacity:'1',transform:'translateY(0)'}},musicBar:{'0%, 100%':{height:'20%'},'50%':{height:'100%'}},pulseBorder:{'0%, 100%':{borderColor:'rgba(99,102,241,0.3)',boxShadow:'0 0 0 0 rgba(99,102,241,0.2)'},'50%':{borderColor:'rgba(99,102,241,0.8)',boxShadow:'0 0 0 10px rgba(99,102,241,0)'}},snowShake:{'0%, 100%':{transform:'translateX(0)'},'25%':{transform:'translateX(-1px)'},'75%':{transform:'translateX(1px)'}}},cursor:{'col-resize':'col-resize','row-resize':'row-resize','nwse-resize':'nwse-resize'}}}};
    </script><style>*,*::before,*::after{-webkit-user-select:none!important;-moz-user-select:none!important;-ms-user-select:none!important;user-select:none!important;-webkit-user-drag:none!important;}input,textarea,[contenteditable="true"]{-webkit-user-select:text!important;-moz-user-select:text!important;-ms-user-select:text!important;user-select:text!important;cursor:text!important;}.security-overlay{position:absolute;top:0;left:0;width:100%;height:100%;z-index:10;pointer-events:none;}::-webkit-scrollbar{width:4px;height:4px;}::-webkit-scrollbar-track{background:transparent;}::-webkit-scrollbar-thumb{background:rgba(255,255,255,.1);border-radius:10px;}::-webkit-scrollbar-thumb:hover{background:rgba(255,255,255,.2);}
    /* MOBILE OPTIMIZATION: Use dvh to fix mobile browser bar issues */
    body {
        background-color: #09090b;
        color: #e2e8f0;
        overflow: hidden; /* App-like feel for outer wrapper */
        margin: 0;
        padding: 0;
        width: 100vw;
        height: 100vh; /* Fallback */
        height: 100dvh; /* Dynamic viewport height for modern mobile */
        transition: background-color .8s ease;
        -webkit-overflow-scrolling: touch;
        overscroll-behavior-y: none; /* Prevent browser bounce on body */
    }
    img,svg,video{pointer-events:none;}button{pointer-events:auto!important;}iframe{pointer-events:auto;}.animate-fade-in{animation:fadeIn .4s ease-out forwards}@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.command-bar-container{position:fixed;top:2rem;left:50%;transform:translateX(-50%);z-index:60;width:90%;max-width:800px;transition:all .5s cubic-bezier(.16,1,.3,1)}.command-bar{background:rgba(18,18,21,.6);backdrop-filter:blur(25px);border:1px solid rgba(255,255,255,.08);border-radius:999px;box-shadow:0 10px 40px rgba(0,0,0,.3),inset 0 1px 0 rgba(255,255,255,.05);padding:.5rem;display:flex;align-items:center;gap:.5rem;height:3.5rem}.command-bar:hover,.command-bar:focus-within{background:rgba(18,18,21,.85);border-color:rgba(255,255,255,.15);box-shadow:0 20px 50px rgba(0,0,0,.5),inset 0 1px 0 rgba(255,255,255,.1)}@media (max-width:768px){.command-bar-container{top:1rem;width:95%}.command-bar{height:3.5rem;padding:.25rem .5rem}}.hero-brand{padding-top:8rem;padding-bottom:2rem;width:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;transition:all .8s cubic-bezier(.16,1,.3,1);position:relative;z-index:10;pointer-events:none;max-height:500px;opacity:1;overflow:visible}.hero-brand.minimized{padding-top:5.5rem;padding-bottom:0;transform:scale(.6);opacity:.9;margin-bottom:-1.5rem;height:auto}.brand-flip-container{perspective:1000px;width:280px;height:80px;position:relative}.brand-flipper{width:100%;height:100%;position:relative;transform-style:preserve-3d;transition:transform .8s cubic-bezier(.4,0,.2,1)}.brand-front,.brand-back{position:absolute;width:100%;height:100%;backface-visibility:hidden;-webkit-backface-visibility:hidden;display:flex;align-items:center;justify-content:center}.brand-back{transform:rotateY(180deg)}.flipped .brand-flipper{transform:rotateY(180deg)}.header-hidden-active .command-bar-container{transform:translateX(-50%) translateY(-150%);opacity:0;pointer-events:none}.header-hidden-active .hero-brand{position:absolute!important;top:0;left:0;width:100%;z-index:20;transform:scale(.5) translateY(-20px)!important;padding-top:1rem!important;padding-bottom:0!important;margin-bottom:0!important;opacity:.6!important;height:auto!important;min-height:0!important;overflow:visible!important;visibility:visible!important;pointer-events:none}.header-hidden-active main{padding-top:0!important;height:auto!important;flex:1}.header-hidden-active .sidebar-glass{border-top:none}.theater-mode-active .hero-brand,.theater-mode-active .command-bar-container{transform:translateY(-200%)!important;opacity:0!important;pointer-events:none;display:none}
    
    /* MODIFIED SIDEBAR - GHOST MODE & INTERACTION */
    .sidebar-glass{
        background: rgba(18,18,21,0.2); /* Default is very transparent */
        border-left: 1px solid rgba(255,255,255,0.02);
        backdrop-filter: blur(5px); /* Less blur when idle */
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        z-index: 60;
        height: 100%;
        opacity: 0.4; /* Fade out content slightly when idle */
    }
    
    /* Hover state - Full visibility */
    .sidebar-glass:hover {
        background: rgba(18,18,21,0.95);
        border-left: 1px solid rgba(255,255,255,0.08);
        backdrop-filter: blur(25px);
        opacity: 1;
        box-shadow: -10px 0 30px rgba(0,0,0,0.5);
    }

    /* Active Resizing state - forced full visibility via class */
    .sidebar-glass.resizing-active {
        background: rgba(18,18,21,0.95) !important;
        backdrop-filter: blur(25px) !important;
        opacity: 1 !important;
        transition: none !important; /* Remove transition for snappy resize */
    }

    .theater-mode-active .sidebar-glass{
        background:rgba(18,18,21,.98);
        border-left-color:rgba(165,243,252,.2);
        box-shadow:-10px 0 50px rgba(0,0,0,.8);
        height:100%!important;
        opacity: 1; /* Always visible in theater mode if open */
    }
    @media (max-width:768px){
        .sidebar-glass{
            border-left:1px solid rgba(255,255,255,.1);
            border-top:none;
            position:fixed!important;
            top:0;bottom:0;right:0;z-index:100!important;
            box-shadow:-10px 0 40px rgba(0,0,0,.8);
            opacity: 1; /* Mobile always visible when open */
            background: rgba(18,18,21,0.95);
        }
        .theater-mode-active .sidebar-glass{
            display:flex!important;
            background:rgba(0,0,0,0.98)!important;
            height:100%!important;
        }
    }
    .nevethon-text{color:#fff;font-weight:900;letter-spacing:.1em;position:relative;display:inline-block;text-shadow:0 0 10px rgba(165,243,252,.8),0 0 20px rgba(165,243,252,.5),0 0 40px rgba(99,102,241,.3);font-size:2.5rem;font-family:'Russo One',sans-serif;font-style:italic}.multlives-wrapper{display:flex;align-items:center;gap:1rem}.snow-particle{position:absolute;top:-10px;background:#fff;border-radius:50%;pointer-events:none;animation:iceFall 2s linear infinite;box-shadow:0 0 4px rgba(255,255,255,.9)}.snow-particle:nth-child(1){left:10%;width:2px;height:2px;animation-duration:1.5s;animation-delay:0s}.snow-particle:nth-child(2){left:30%;width:3px;height:3px;animation-duration:2s;animation-delay:.2s}.snow-particle:nth-child(3){left:60%;width:2px;height:2px;animation-duration:1.7s;animation-delay:.5s}.snow-particle:nth-child(4){left:85%;width:3px;height:3px;animation-duration:1.3s;animation-delay:.1s}@keyframes iceFall{0%{transform:translateY(0);opacity:0}10%,90%{opacity:1}100%{transform:translateY(35px);opacity:0}}@keyframes blizzard{0%{transform:translate(0,0) rotate(0deg)}100%{transform:translate(-20px,100vh) rotate(360deg)}}.animate-blizzard{animation:blizzard linear infinite}.aurora-blob{position:absolute;filter:blur(100px);opacity:.3;z-index:0;pointer-events:none}.cursor-grab{cursor:grab}.cursor-grabbing{cursor:grabbing}.kick-chat-container{position:relative;background-color:#0b0e11;width:100%;height:100%}.toolbar-flip-container{perspective:1000px;position:fixed;bottom:1.5rem;left:50%;transform:translateX(-50%);z-index:70;width:auto;height:auto;}.toolbar-flipper{position:relative;transform-style:preserve-3d;transition:transform 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);display:flex;align-items:center;justify-content:center;}.toolbar-flipper.flipped{transform:rotateX(180deg);}.toolbar-front,.toolbar-back{backface-visibility:hidden;-webkit-backface-visibility:hidden;}.toolbar-front{position:relative;z-index:2;transform:rotateX(0deg);display:flex;align-items:center;background:rgba(13,13,16,.6);backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.05);border-radius:99px;box-shadow:0 5px 20px rgba(0,0,0,.2);padding:.35rem;gap:.5rem;transition:all .4s cubic-bezier(.16,1,.3,1);cursor:grab;}.toolbar-front:active{cursor:grabbing;}.toolbar-front.active{background:rgba(13,13,16,.95);backdrop-filter:blur(20px);border-color:rgba(255,255,255,.15);box-shadow:0 10px 40px rgba(0,0,0,.6), 0 0 20px rgba(99,102,241,.1);padding:.5rem;}.toolbar-back{position:absolute;top:0;left:0;width:100%;height:100%;transform:rotateX(180deg);display:flex;align-items:center;justify-content:center;}.patrol-timer-badge{display:flex;align-items:center;gap:0.5rem;background:rgba(13,13,16,.95);backdrop-filter:blur(10px);border:1px solid rgba(74, 222, 128, 0.3);color:#4ade80;padding:0.4rem 1.2rem;border-radius:99px;box-shadow:0 10px 30px rgba(0,0,0,.5);font-weight:800;font-size:0.9rem;letter-spacing:0.05em;}.blackout-overlay{position:fixed;inset:0;background:#000;opacity:0;pointer-events:none;z-index:5;transition:opacity 1s ease}.theater-mode-active .blackout-overlay{opacity:.85}@media (max-width:768px){.toolbar-flip-container{bottom:1.5rem;width:90vw;max-width:380px;}.toolbar-front{width:100%;justify-content:center;flex-wrap:wrap;gap:12px!important;padding:12px 16px!important;border-radius:24px!important;background:rgba(13,13,16,.9)!important;border:1px solid rgba(255,255,255,0.1);box-shadow:0 10px 30px rgba(0,0,0,0.5)!important;}.toolbar-front.active{padding:16px!important;border-color:rgba(99,102,241,0.3);}.toolbar-front button{padding:0.8rem!important;border-radius:12px!important;background-color:rgba(255,255,255,0.05);flex:0 0 auto;transition:transform 0.2s, background-color 0.2s;min-width:44px;min-height:44px;display:flex;align-items:center;justify-content:center;}.toolbar-front button:active{transform:scale(0.95);background-color:rgba(255,255,255,0.15);}.toolbar-front svg{width:22px!important;height:22px!important;}}.stream-offline{filter:grayscale(100%) brightness(0.6);transform:scale(0.95);opacity:0.7;pointer-events:none;}.stream-offline:hover{filter:grayscale(80%) brightness(0.8);opacity:0.9;transform:scale(0.97);}.offline-overlay-pattern{background-image:linear-gradient(45deg, #111 25%, transparent 25%), linear-gradient(-45deg, #111 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #111 75%), linear-gradient(-45deg, transparent 75%, #111 75%);background-size:20px 20px;background-position:0 0, 0 10px, 10px -10px, -10px 0px;}
    /* Landscape Mode Mobile Optimization */
    @media (max-height: 500px) and (orientation: landscape) {
        .command-bar-container { top: 0.5rem; transform: translateX(-50%) scale(0.8); width: auto; max-width: 90%; }
        .hero-brand { display: none; }
        .hero-brand.minimized { display: none; }
        .toolbar-flip-container { bottom: 0.5rem; transform: translateX(-50%) scale(0.8); }
        main { padding-top: 3.5rem !important; }
        /* Make scrollbars thinner for landscape */
        ::-webkit-scrollbar { width: 3px; height: 3px; }
        .sidebar-glass { width: 300px !important; }
    }
    .cinema-glow::after {
        content: '';
        position: absolute;
        inset: 0;
        box-shadow: inset 0 0 20px rgba(0,0,0,0.5);
        pointer-events: none;
        z-index: 2;
        border-radius: inherit;
    }
    </style></head><body oncontextmenu="return false;" ondragstart="return false;" onselectstart="return false;"><div id="root"></div><script type="text/babel">const _AUTHOR_HASH = "KAOZYKING_SECURE_V3_ULTRA";const { useState, useEffect, useRef, memo, useCallback, useMemo } = React, { createPortal } = ReactDOM;const translations={pt:{welcome:"Bem vindos ao",add_btn:"Adicionar",placeholder_twitch:"Canal Twitch...",placeholder_kick:"Canal Kick...",placeholder_yt:"Vídeo YT...",placeholder_default:"Adicionar Canal...",map_btn:"Mapa",hide_btn:"Ocultar",realtime_loc:"Localização",empty_title:"Seu painel está vazio",empty_desc:"Adicione canais da Twitch, Kick ou vídeos do YouTube usando a barra superior.",dev_by:"Desenvolvido por",cinema_mode:"Cinema",chat_btn:"Chat",tt_add:"Adicionar Stream",tt_mute_all:"Mutar todas",tt_unmute_all:"Desmutar todas",tt_cinema_exit:"Sair do Modo Cinema",tt_cinema_enter:"Ativar Modo Cinema",tt_hide_chat:"Ocultar chat",tt_show_chat:"Mostrar chat",chat_visible:"Visível",chat_hidden:"Chat",warning_title:"Aviso Importante",warning_text:"Hospede no Vercel.",toast_added:"Streamer adicionado!",toast_exists:"Streamer já na lista!",toast_empty:"Digite o nome!",intro_title:"NEVETHON",intro_msg:"O COMBUSTÍVEL É O SEU DONATE",intro_sub:"SÓ DURA SE VOCÊ DOAR",layout_auto:"Auto",layout_grid:"Grade",layout_focus:"Foco",squads_title:"Squads",squad_save:"Salvar",squad_load:"Carregar",squad_name_ph:"Nome do Grupo",squad_saved:"Squad Saved!",squad_deleted:"Squad Removido!",skip_intro:"Pular Intro",pip_active:"Super PiP Ativo",pip_desc:"Vídeos em janela flutuante.",pip_bring_back:"Trazer de Volta",tt_pip:"Janela Flutuante",pip_error:"PiP não suportado. Use Chrome Desktop.",tt_reset_size:"Redefinir Tamanho",history:"Recentes",history_clear:"Limpar",sleep_title:"Modo Sono",sleep_active:"Modo Sono Ativo",sleep_msg:"Boa noite!",ctx_refresh:"Recarregar",ctx_focus:"Focar/Desfocar",ctx_copy:"Copiar Link",ctx_close:"Fechar Stream",tt_menu:"Menu", tt_solo: "Modo Solo (Foco de Áudio)", tt_unsolo: "Desativar Solo", patrol_title: "Modo Ronda", patrol_desc: "Troca automática de câmeras (Estilo BBB)", patrol_active: "Ronda Ativa", tt_patrol: "Modo Ronda / Auto-Switch", patrol_chat_switch: "Sincronizar Chat", tour_welcome_title: "Bem-vindo ao MultLives!", tour_welcome_text: "Vamos fazer um tour rápido para você aproveitar ao máximo sua experiência de multistreaming.", tour_next: "Próximo", tour_finish: "Começar", tour_step1_title: "Adicione Streams", tour_step1_text: "Use this top bar to add Twitch, Kick, or YouTube channels. Basta digitar o nome e clicar em +.", tour_step2_title: "Controle Total", tour_step2_text: "Aqui embaixo você controla tudo: Layouts, Modo Ronda, Timer de Sono, PiP e Squads. Você pode arrastar este menu para onde quiser!", tour_step3_title: "Chat e Mapa", tour_step3_text: "Na lateral direita ficam os chats e o mapa em tempo real (se disponível). Você pode alternar entre chats clicando nos ícones dos streamers.", tt_pin: "Fixar Menu", tt_unpin: "Desafixar (Auto-Ocultar)"},en:{welcome:"Welcome to",add_btn:"Add",placeholder_twitch:"Twitch Channel...",placeholder_kick:"Kick Channel...",placeholder_yt:"YT Video...",placeholder_default:"Add Channel...",map_btn:"Map",hide_btn:"Hide",realtime_loc:"Location",empty_title:"Dashboard empty",empty_desc:"Add Twitch, Kick channels, or YouTube videos.",dev_by:"Developed by",cinema_mode:"Cinema",chat_btn:"Chat",tt_add:"Add Stream",tt_mute_all:"Mute all",tt_unmute_all:"Unmute all",tt_cinema_exit:"Exit Cinema Mode",tt_cinema_enter:"Enable Cinema Mode",tt_hide_chat:"Hide chat",tt_show_chat:"Show chat",chat_visible:"Visível",chat_hidden:"Chat",warning_title:"Notice",warning_text:"Host online.",toast_added:"Streamer added!",toast_exists:"Already listed!",toast_empty:"Enter name!",intro_title:"NEVETHON",intro_msg:"FUEL IS YOUR SUB",intro_sub:"ONLY LASTS IF YOU DONATE",layout_auto:"Auto",layout_grid:"Grid",layout_focus:"Focus",squads_title:"Squads",squad_save:"Save",squad_load:"Load",squad_name_ph:"Group Name",squad_saved:"Squad Saved!",squad_deleted:"Deleted!",skip_intro:"Skip Intro",pip_active:"Super PiP Active",pip_desc:"Videos floating.",pip_bring_back:"Bring Back",tt_pip:"Floating Window",pip_error:"PiP not supported. Use Chrome Desktop.",tt_reset_size:"Reset Size",history:"Recent",history_clear:"Clear",sleep_title:"Sleep Timer",sleep_active:"Sleep Mode Active",sleep_msg:"Good night!",ctx_refresh:"Reload",ctx_focus:"Focus/Unfocus",ctx_copy:"Copy Link",ctx_close:"Close Stream",tt_menu:"Menu", tt_solo: "Solo Mode (Audio Focus)", tt_unsolo: "Disable Solo", patrol_title: "Patrol Mode", patrol_desc: "Auto camera switch (Big Brother Style)", patrol_active: "Patrol Active", tt_patrol: "Patrol Mode", patrol_chat_switch: "Sync Chat", tour_welcome_title: "Welcome to MultLives!", tour_welcome_text: "Let's take a quick tour to help you get the most out of your multistreaming experience.", tour_next: "Next", tour_finish: "Start", tour_step1_title: "Add Streams", tour_step1_text: "Use this top bar to add Twitch, Kick, or YouTube channels. Just type the name and click +.", tour_step2_title: "Total Control", tour_step2_text: "Down here you control everything: Layouts, Patrol Mode, Sleep Timer, PiP, and Squads. You can drag this menu anywhere!", tour_step3_title: "Chat & Map", tour_step3_text: "On the right side are the chats and real-time map (if available). You can switch chats by clicking the streamer icons.", tt_pin: "Pin Menu", tt_unpin: "Unpin (Auto-Hide)"}};
const PlusIcon=()=><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>;
const TrashIcon=({width,height})=><svg xmlns="http://www.w3.org/2000/svg" width={width||14} height={height||14} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>;
const MapIcon=()=><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="1 6 1 22 8 18 16 22 23 18 23 2 16 6 8 2 1 6"></polygon><line x1="8" y1="2" x2="8" y2="18"></line><line x1="16" y1="6" x2="16" y2="22"></line></svg>;
const LayoutIcon=({width,height})=><svg xmlns="http://www.w3.org/2000/svg" width={width||16} height={height||16} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="9" y1="3" x2="9" y2="21"></line></svg>;
const TwitchIcon=({width, height})=><svg xmlns="http://www.w3.org/2000/svg" width={width||14} height={height||14} viewBox="0 0 24 24" fill="currentColor"><path d="M11.571 4.714h1.715v5.143H11.57zm4.715 0H18v5.143h-1.714zM6 0L1.714 4.286v15.428h5.143V24l4.286-4.286h3.428L22.286 12V0zm14.571 11.143l-3.428 3.428h-3.429l-3 3v-3H6.857V1.714h13.714Z"/></svg>;
const YoutubeIcon=()=><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/></svg>;
const ExpandIcon=()=><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="15 3 21 3 21 9"></polyline><polyline points="9 21 3 21 3 21 3 15"></polyline><line x1="21" y1="3" x2="14" y2="10"></line><line x1="3" y1="21" x2="10" y2="14"></line></svg>;
const CompressIcon=()=><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="4 14 10 14 10 20"></polyline><polyline points="20 10 14 10 14 4"></polyline><line x1="14" y1="10" x2="21" y2="3"></line><line x1="3" y1="21" x2="10" y2="14"></line></svg>;
const MoonIcon=({width,height})=><svg xmlns="http://www.w3.org/2000/svg" width={width||16} height={height||16} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></svg>;
const SunIcon=({width,height})=><svg xmlns="http://www.w3.org/2000/svg" width={width||16} height={height||16} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="M4.93 4.93l1.41 1.41"/><path d="M17.66 17.66l1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="M6.34 17.66l-1.41 1.41"/><path d="M19.07 4.93l-1.41-1.41"/></svg>;
const RefreshCwIcon=({width,height})=><svg xmlns="http://www.w3.org/2000/svg" width={width||14} height={height||14} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path><path d="M21 3v5h-5"></path><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path><path d="M3 21v-5h5"></path></svg>;
const Volume2Icon=({width,height})=><svg xmlns="http://www.w3.org/2000/svg" width={width||16} height={height||16} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg>;
const VolumeXIcon=({width,height})=><svg xmlns="http://www.w3.org/2000/svg" width={width||16} height={height||16} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><line x1="23" y1="9" x2="17" y2="15"></line><line x1="17" y1="9" x2="23" y2="15"></line></svg>;
const SplitIcon=()=><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="3" y1="12" x2="21" y2="12"></line></svg>;
const ChevronDownIcon=({width,height})=><svg xmlns="http://www.w3.org/2000/svg" width={width||18} height={height||18} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>;
const SearchIcon=({className})=><svg className={className} xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>;
const GridIcon=({width,height})=><svg xmlns="http://www.w3.org/2000/svg" width={width||16} height={height||16} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></svg>;
const LayoutTemplateIcon=({width,height})=><svg xmlns="http://www.w3.org/2000/svg" width={width||16} height={height||16} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="21" y1="9" x2="3" y2="9"></line><line x1="9" y1="9" x2="9" y2="21"></line></svg>;
const UsersIcon=({width,height})=><svg xmlns="http://www.w3.org/2000/svg" width={width||16} height={height||16} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>;
const SaveIcon=()=><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></svg>;
const XIcon=({width,height})=><svg xmlns="http://www.w3.org/2000/svg" width={width||14} height={height||14} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>;
const SettingsIcon=({width,height})=><svg xmlns="http://www.w3.org/2000/svg" width={width||20} height={height||20} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>;
const ExternalLinkIcon=({width,height})=><svg xmlns="http://www.w3.org/2000/svg" width={width||16} height={height||16} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg>;
const ScaleIcon=()=><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 7v10a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2z"></path><path d="M7 9v2"></path><path d="M11 9v2"></path><path d="M15 9v2"></path></svg>;
const ChatIcon=({width,height})=><svg xmlns="http://www.w3.org/2000/svg" width={width||16} height={height||16} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>;
const HeartIcon=({className,width,height})=><svg xmlns="http://www.w3.org/2000/svg" width={width||20} height={height||20} viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>;
const LogoML=()=><svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M5 19V5" stroke="white" strokeWidth="3" strokeLinecap="round" /><path d="M19 19V5" stroke="white" strokeWidth="3" strokeLinecap="round" /><path d="M5 5L12 13L19 5" stroke="#a5f3fc" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round" /></svg>;
const ClockIcon=({width,height})=><svg xmlns="http://www.w3.org/2000/svg" width={width||16} height={height||16} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>;
const CopyIcon=({width,height})=><svg xmlns="http://www.w3.org/2000/svg" width={width||14} height={height||14} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>;
const PanelRightIcon=({width,height})=><svg xmlns="http://www.w3.org/2000/svg" width={width||16} height={height||16} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="18" height="18" x="3" y="3" rx="2" ry="2"></rect><line x1="15" x2="15" y1="3" y2="21"></line></svg>;
const HeadphonesIcon = ({width, height}) => <svg xmlns="http://www.w3.org/2000/svg" width={width||14} height={height||14} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 18v-6a9 9 0 0 1 18 0v6"/><path d="M21 19a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3zM3 19a2 2 0 0 0 2 2h1a2 2 0 0 0 2-2v-3a2 2 0 0 0-2-2H3z"/></svg>;
const AlertTriangleIcon = ({width, height}) => <svg xmlns="http://www.w3.org/2000/svg" width={width||16} height={height||16} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>;
const PopoutIcon = ({width, height}) => <svg xmlns="http://www.w3.org/2000/svg" width={width||16} height={height||16} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6" /><polyline points="15 3 21 3 21 9" /><line x1="10" y1="14" x2="21" y2="3" /></svg>;
const InstagramIcon = ({width,height}) => <svg xmlns="http://www.w3.org/2000/svg" width={width||16} height={height||16} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path><line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line></svg>;
const SignalOffIcon = ({width, height}) => <svg xmlns="http://www.w3.org/2000/svg" width={width||24} height={height||24} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="1" y1="1" x2="23" y2="23"></line><path d="M2 20h.01"/><path d="M7 20v-4"/><path d="M12 20v-8"/><path d="M17 20V8"/></svg>;
const WifiOffIcon = ({width, height}) => <svg xmlns="http://www.w3.org/2000/svg" width={width||24} height={height||24} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="1" y1="1" x2="23" y2="23"></line><path d="M16.72 11.06A10.94 10.94 0 0 1 19 12.55"/><path d="M5 12.55a10.94 10.94 0 0 1 5.17-2.39"/><path d="M10.71 5.05A16 16 0 0 1 22.58 9"/><path d="M1.42 9a15.91 15.91 0 0 1 4.7-2.88"/><path d="M8.53 16.11a6 6 0 0 1 6.95 0"/><line x1="12" y1="20" x2="12.01" y2="20"/></svg>;
const KeyIcon = ({width, height}) => <svg xmlns="http://www.w3.org/2000/svg" width={width||16} height={height||16} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"/></svg>;
const MenuIcon = ({width, height}) => <svg xmlns="http://www.w3.org/2000/svg" width={width||24} height={height||24} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="4" y1="12" x2="20" y2="12"></line><line x1="4" y1="6" x2="20" y2="6"></line><line x1="4" y1="18" x2="20" y2="18"></line></svg>;
const RadarIcon = ({width, height}) => <svg xmlns="http://www.w3.org/2000/svg" width={width||20} height={height||20} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 12c-3-3-3-8 0-11"/><path d="M16.9 7.1c2.5 2.5 2.5 6.5 0 9"/><path d="M19.8 4.2c4.3 4.3 4.3 11.3 0 15.6"/><path d="M7.1 16.9c-2.5-2.5-2.5-6.5 0-9"/><path d="M4.2 19.8c-4.3-4.3-4.3-11.3 0-15.6"/><circle cx="12" cy="12" r="1"/></svg>;
const PinIcon = ({width, height}) => <svg xmlns="http://www.w3.org/2000/svg" width={width||16} height={height||16} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="17" x2="12" y2="22"></line><path d="M5 17h14v-1.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V6h1a2 2 0 0 0 0-4H8a2 2 0 0 0 0 4h1v4.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24Z"></path></svg>;
const PinOffIcon = ({width, height}) => <svg xmlns="http://www.w3.org/2000/svg" width={width||16} height={height||16} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="2" y1="2" x2="22" y2="22"></line><line x1="12" y1="17" x2="12" y2="22"></line><path d="M9 9v1.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24V17h14"></path><path d="M15 9.34V6h1a2 2 0 0 0 0-4H7.89"></path></svg>;
const fetchAvatar = async (platform, name) => {try{if(platform==='twitch'){const res=await fetch(`https://decapi.me/twitch/avatar/${name}`);const url=await res.text();return url&&url.startsWith('http')?url:null;}else if(platform==='kick'){const res=await fetch(`https://decapi.me/kick/avatar/${name}`);const url=await res.text();return url&&url.startsWith('http')?url:null;}return null;}catch(e){console.warn(`Erro ao buscar avatar para ${name}:`,e);return null;}};
const Tooltip = ({ text, children, className="", position="top" }) => {const [show,setShow]=useState(false);const [coords,setCoords]=useState({top:0,left:0});const triggerRef=useRef(null);const updateCoords=()=>{if(triggerRef.current){const rect=triggerRef.current.getBoundingClientRect();if(position==='top'){setCoords({top:rect.top-12,left:rect.left+rect.width/2,origin:'bottom'})}else if(position==='left'){setCoords({top:rect.top+rect.height/2,left:rect.left-12,origin:'right'})}}};const handleMouseEnter=()=>{updateCoords();setShow(true)};return(<div ref={triggerRef} className={`relative flex items-center justify-center ${className}`} onMouseEnter={handleMouseEnter} onMouseLeave={()=>setShow(false)}>{children}{show&&createPortal(<div style={{position:'fixed',top:`${coords.top}px`,left:`${coords.left}px`,transform:position==='top'?'translate(-50%, -100%)':'translate(-100%, -50%)',zIndex:9999,pointerEvents:'none'}} className="animate-fade-in"><div className="px-2.5 py-1 bg-[#1e1e24] border border-white/10 text-white text-[10px] font-bold rounded-lg shadow-2xl whitespace-nowrap">{text}<div className={`absolute w-2 h-2 bg-[#1e1e24] rotate-45 border-white/10 ${position==='top'?'left-1/2 -translate-x-1/2 -bottom-1 border-r border-b':'top-1/2 -translate-y-1/2 -right-1 border-t border-r'}`}></div></div></div>,document.body)}</div>)};
const useToast = () => {const [toasts,setToasts]=useState([]);const addToast=useCallback((message,type='info')=>{const id=Date.now();setToasts(p=>[...p,{id,message,type}]);setTimeout(()=>setToasts(p=>p.filter(t=>t.id!==id)),3000)},[]);return {toasts,addToast}};
const ToastContainer = ({ toasts }) => (<div className="fixed bottom-24 right-6 z-[100] flex flex-col gap-3 pointer-events-none">{toasts.map(t=><div key={t.id} className="animate-toast-in bg-black/80 backdrop-blur-md border border-white/10 text-white px-4 py-3 rounded-lg shadow-2xl flex items-center gap-3 min-w-[200px]">{t.type==='error'&&<span className="text-red-400">✕</span>}{t.type==='success'&&<span className="text-green-400">✓</span>}{t.type==='info'&&<span className="text-ice">ℹ</span>}<span className="text-sm font-medium">{t.message}</span></div>)}</div>);
const SettingsModal = ({ isOpen, onClose, twitchConfig, setTwitchConfig, youtubeApiKey, setYoutubeApiKey, lang }) => {const [localTwitch,setLocalTwitch]=useState(twitchConfig);const [localYtKey,setLocalYtKey]=useState(youtubeApiKey);const t=(key)=>translations[lang][key];useEffect(()=>{setLocalTwitch(twitchConfig);setLocalYtKey(youtubeApiKey)},[twitchConfig,youtubeApiKey,isOpen]);if(!isOpen)return null;const handleSave=()=>{setTwitchConfig(localTwitch);setYoutubeApiKey(localYtKey);onClose()};return(<div className="fixed inset-0 z-[80] flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-fade-in" onClick={onClose}><div className="bg-[#121215] border border-white/10 w-full max-w-md rounded-2xl p-6 shadow-2xl relative" onClick={e=>e.stopPropagation()}><h2 className="text-white font-bold text-lg mb-4 flex items-center gap-2"><SettingsIcon width={20}/> Configurações de API</h2><div className="space-y-4 mb-6"><div className="bg-white/5 p-4 rounded-xl border border-white/5"><h3 className="text-[#9146ff] font-bold text-xs uppercase tracking-wider mb-3 flex items-center gap-2"><TwitchIcon width={12}/> Twitch Helix API</h3><div className="space-y-3"><div><label className="text-gray-400 text-xs block mb-1">Client ID</label><input type="text" value={localTwitch.clientId} onChange={e=>setLocalTwitch({...localTwitch,clientId:e.target.value})} className="w-full bg-black/50 border border-white/10 rounded-lg px-3 py-2 text-sm text-white focus:border-[#9146ff] outline-none" placeholder="Opcional"/></div><div><label className="text-gray-400 text-xs block mb-1">Access Token</label><input type="password" value={localTwitch.token} onChange={e=>setLocalTwitch({...localTwitch,token:e.target.value})} className="w-full bg-black/50 border border-white/10 rounded-lg px-3 py-2 text-sm text-white focus:border-[#9146ff] outline-none" placeholder="Opcional"/></div><p className="text-[10px] text-gray-500 leading-relaxed">Sem credenciais, o player assume que a live está sempre Online.</p></div></div><div className="bg-white/5 p-4 rounded-xl border border-white/5"><h3 className="text-[#ff0000] font-bold text-xs uppercase tracking-wider mb-3 flex items-center gap-2"><YoutubeIcon width={12}/> YouTube Data API v3</h3><div><label className="text-gray-400 text-xs block mb-1">API Key</label><input type="password" value={localYtKey} onChange={e=>setLocalYtKey(e.target.value)} className="w-full bg-black/50 border border-white/10 rounded-lg px-3 py-2 text-sm text-white focus:border-[#ff0000] outline-none" placeholder="Opcional"/></div><p className="text-[10px] text-gray-500 leading-relaxed mt-2">Necessário para detectar status Offline no YouTube. <br/><span className="text-yellow-500/80">Atenção:</span> Consome cota da API.</p></div><div className="bg-white/5 p-4 rounded-xl border border-white/5"><h3 className="text-[#53fc18] font-bold text-xs uppercase tracking-wider mb-2 flex items-center gap-2"><span className="bg-[#53fc18] text-black w-3 h-3 flex items-center justify-center rounded-sm text-[8px]">K</span> Kick Status</h3><p className="text-[10px] text-gray-400 leading-relaxed">Utiliza a API pública da comunidade (DecAPI) para verificar status automaticamente. Não requer configuração.</p></div></div><div className="flex justify-end gap-2"><button onClick={onClose} className="px-4 py-2 text-xs font-bold text-gray-400 hover:text-white transition-colors">Cancelar</button><button onClick={handleSave} className="px-6 py-2 bg-white text-black text-xs font-bold rounded-full hover:bg-gray-200 transition-colors shadow-lg">Salvar</button></div></div></div>)};
const Credits=({isSidebarOpen,sidebarWidth})=>{const [visible,setVisible]=useState(true);useEffect(()=>{const t=setTimeout(()=>setVisible(false),5000);return ()=>clearTimeout(t)},[]);return(<div className={`fixed z-[60] flex items-center gap-2 transition-all duration-700 ease-out group/credits bottom-4 right-4 md:bottom-6 md:right-6 ${visible?'opacity-100 translate-y-0':'opacity-0 translate-y-4 md:opacity-30 md:translate-y-0 md:hover:opacity-100'}`} style={{right:(typeof window!=='undefined'&&window.innerWidth>=768&&isSidebarOpen)?`${sidebarWidth+30}px`:undefined}}><div className={`flex items-center gap-2 overflow-hidden transition-all duration-500 ${visible?'w-auto opacity-100':'w-0 opacity-0 group-hover/credits:w-auto group-hover/credits:opacity-100'}`}><a href="https://www.twitch.tv/kaozyking" target="_blank" className="p-1.5 bg-[#9146ff] text-white rounded-full hover:scale-110 transition-transform shadow-lg"><TwitchIcon width={12} height={12}/></a><a href="https://www.instagram.com/oeduardomacedo" target="_blank" className="p-1.5 bg-pink-600 text-white rounded-full hover:scale-110 transition-transform shadow-lg"><InstagramIcon width={12} height={12}/></a></div><div className="px-2 py-1 bg-black/40 backdrop-blur-md border border-white/5 rounded-full text-[10px] font-medium text-gray-400 group-hover/credits:text-white group-hover/credits:bg-black/80 transition-colors shadow-xl cursor-default">Dev by <span className="font-bold text-ice">KaozyKing</span></div></div>)};
const DonatePopup=({onClose})=>(<div className="fixed bottom-24 left-4 right-4 md:left-auto md:right-6 md:w-96 z-[90] animate-slide-up pointer-events-auto"><div className="relative group"><div className="absolute -inset-0.5 bg-gradient-to-r from-purple-600 via-pink-500 to-cyan-500 rounded-2xl blur opacity-30 group-hover:opacity-70 transition duration-1000"></div><div className="relative bg-[#121215]/95 backdrop-blur-xl border border-white/10 rounded-2xl p-5 shadow-2xl flex gap-4 items-start ring-1 ring-white/5"><button onClick={onClose} className="absolute top-2 right-2 text-gray-500 hover:text-white bg-white/5 hover:bg-white/10 rounded-full p-1.5 transition-colors"><XIcon width={12} height={12}/></button><div className="shrink-0 w-12 h-12 rounded-full bg-gradient-to-br from-purple-500/10 to-cyan-500/10 border border-white/10 flex items-center justify-center shadow-inner"><HeartIcon className="text-pink-500 animate-heart-beat drop-shadow-[0_0_8px_rgba(236,72,153,0.5)]" width={24} height={24}/></div><div className="flex-1 pr-2"><h3 className="text-white font-bold text-sm mb-1.5 flex items-center gap-2">Apoie o NEVETHON! <span className="text-xs bg-purple-500/20 text-purple-300 px-1.5 py-0.5 rounded border border-purple-500/30">Donate</span></h3><p className="text-gray-300 text-xs leading-relaxed font-medium">Já enviou uma mensagem para seu streamer? <br className="mb-2 block"/>Digite <span className="text-black font-extrabold bg-cyan-400 px-1.5 py-0.5 rounded mx-0.5 shadow-[0_0_10px_rgba(34,211,238,0.5)] cursor-pointer hover:scale-105 inline-block transition-transform select-all">!pix</span> no chat e mande agora mesmo.</p></div></div></div></div>);
const TourGuide = ({ onFinish, lang }) => {
    const [step,setStep]=useState(0);
    const t=(key)=>translations[lang][key];

    useEffect(()=>{
        // Seletores dos elementos que serão destacados
        const els={1:document.querySelector('.command-bar-container'),2:document.querySelector('.toolbar-flip-container'),3:document.querySelector('.sidebar-glass')};
        
        // Limpeza: remove classes de destaque anteriores
        document.querySelectorAll('.tour-highlight').forEach(e=>e.classList.remove('tour-highlight','z-[80]')); 
        
        if(step>0&&els[step]){
            // Adiciona apenas z-index alto
            els[step].classList.add('tour-highlight','z-[80]'); 
            
            if(step===2)els[step].querySelector('.toolbar-flipper')?.classList.add('tour-forced-flip')
        }
        return ()=>{
            document.querySelectorAll('.tour-highlight').forEach(e=>e.classList.remove('tour-highlight','z-[80]'));
            document.querySelector('.toolbar-flipper')?.classList.remove('tour-forced-flip')
        }
    },[step]);

    // Função para encerrar e marcar como visto
    const handleClose = () => {
        onFinish(); // Isso chama a função do App que seta o localStorage
    };

    const next=()=>step<3?setStep(s=>s+1):handleClose();
    
    const getPos=()=>{
        switch(step){
            case 0: return 'top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2';
            case 1: return 'top-24 left-1/2 -translate-x-1/2 mt-4';
            case 2: return 'bottom-24 left-1/2 -translate-x-1/2 mb-4';
            case 3: return 'top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 md:left-auto md:right-[20%] md:translate-x-0'; 
            default: return 'hidden';
        }
    };

    return(
        <div className="fixed inset-0 z-[75] bg-black/70 backdrop-blur-sm animate-fade-in">
            <div className="absolute inset-0 z-0" onClick={next}></div>
            <div className={`absolute transition-all duration-500 ease-out z-[90] w-[90vw] max-w-sm ${getPos()}`}>
                <div className="bg-[#121215] border border-white/20 p-6 rounded-2xl shadow-[0_0_50px_rgba(0,0,0,0.5)] w-full relative overflow-hidden backdrop-blur-xl">
                    {/* Botão de Fechar Adicionado */}
                    <button onClick={handleClose} className="absolute top-3 right-3 p-1.5 text-gray-400 hover:text-white bg-white/5 hover:bg-white/10 rounded-full transition-colors z-20" title="Fechar Tour"><XIcon width={14} height={14}/></button>

                    <div className="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500"></div>
                    <h3 className="text-xl font-bold text-white mb-2">{t(step===0?'tour_welcome_title':`tour_step${step}_title`)}</h3>
                    <p className="text-gray-400 text-sm mb-6 leading-relaxed">{t(step===0?'tour_welcome_text':`tour_step${step}_text`)}</p>
                    <div className="flex justify-between items-center">
                        <div className="flex gap-1">{[0,1,2,3].map(i=>(<div key={i} className={`w-2 h-2 rounded-full transition-colors ${i===step?'bg-white':'bg-white/20'}`}></div>))}</div>
                        <button onClick={next} className="bg-white text-black px-6 py-2 rounded-full font-bold text-sm hover:bg-gray-200 transition-colors shadow-lg">{t(step===0?'tour_finish':step===3?'tour_finish':'tour_next')}</button>
                    </div>
                </div>
            </div>
        </div>
    )
};
const KickChatEmbed = ({ streamName, isResizing, idSuffix='' }) => {const [status,setStatus]=useState('warning'),[showNativeHint,setShowNativeHint]=useState(true);useEffect(()=>{const timer=setTimeout(()=>setStatus('loaded'),4000);return ()=>clearTimeout(timer)},[]);return(<div onContextMenu={e=>e.preventDefault()} className="w-full h-full relative group/kick bg-[#0b0e11] flex flex-col overflow-hidden">{status==='warning'&&<div className="absolute inset-0 z-50 flex flex-col items-center justify-center bg-[#0b0e11] p-6 text-center animate-fade-in"><div className="w-12 h-12 bg-[#53fc18]/20 rounded-full flex items-center justify-center mb-4 border border-[#53fc18]"><span className="text-[#53fc18] font-bold text-xl">!</span></div><h3 className="text-white font-bold text-sm mb-2 uppercase tracking-wide">Aviso de Segurança (Cookies)</h3><p className="text-gray-400 text-xs max-w-xs mb-4 leading-relaxed">Navegadores bloqueiam cookies de terceiros em iframes. Se o chat pedir login, use a opção <strong>"Janela Nativa"</strong>.</p><div className="w-full max-w-[200px] h-1 bg-white/10 rounded-full overflow-hidden"><div className="h-full bg-[#53fc18] animate-[width_4s_linear_forwards]" style={{width:'0%'}}></div></div><button onClick={()=>setStatus('loaded')} className="mt-4 text-[10px] text-gray-500 hover:text-white underline cursor-pointer">Entendi</button></div>}{status==='loaded'&&<iframe id={`kick-iframe-${streamName}${idSuffix}`} src={`https://kick.com/popout/${streamName}/chat`} className={`w-full h-full border-none bg-[#0b0e11] ${isResizing?'pointer-events-none':''}`} referrerPolicy="no-referrer" allow="clipboard-write; storage-access-by-user-activation"></iframe>}{status==='loaded'&&showNativeHint&&<div className="absolute inset-0 z-50 flex items-center justify-center pointer-events-none p-4"><div className="bg-[#1a1d21] border border-[#53fc18]/30 rounded-xl shadow-2xl p-5 relative animate-fade-in pointer-events-auto max-w-[280px] w-full"><button onClick={()=>setShowNativeHint(false)} className="absolute top-2 right-2 p-1.5 text-gray-400 hover:text-white bg-white/5 hover:bg-white/10 rounded-full transition-colors"><XIcon/></button><div className="flex flex-col items-center text-center gap-3 mt-1"><div className="w-10 h-10 bg-[#53fc18]/10 rounded-full flex items-center justify-center text-[#53fc18] border border-[#53fc18]/20"><ExternalLinkIcon width={20} height={20}/></div><div><h4 className="text-white font-bold text-sm mb-1">Login Necessário?</h4><p className="text-[11px] text-gray-400 leading-relaxed">Para interagir no chat sem erros de cookie.</p></div><button onClick={()=>{window.open(`https://kick.com/popout/${streamName}/chat`,`kick_chat_${streamName}`,`width=400,height=${window.innerHeight},left=${window.screen.width-400},top=0,menubar=no,toolbar=no,location=no,status=no`);setShowNativeHint(false)}} className="bg-[#53fc18] hover:bg-[#42ca14] text-black text-xs font-bold py-2.5 px-4 rounded-lg w-full shadow-lg shadow-[#53fc18]/10 flex items-center justify-center gap-2"><span>Abrir Janela Nativa</span></button></div></div></div>}</div>)};
const HeroBrand=({minimized, isNevethonActive})=>{const [isFlipped,setIsFlipped]=useState(false);useEffect(()=>{const interval=setInterval(()=>setIsFlipped(p=>!p),6000);return ()=>clearTimeout(interval)},[]);return(<div className={`hero-brand ${minimized?'minimized':''}`}><div className={`brand-flip-container ${isFlipped?'flipped':''}`}><div className="brand-flipper"><div className="brand-front"><div className="multlives-wrapper"><div className={`w-14 h-14 tech-gradient rounded-2xl flex items-center justify-center text-white shadow-[0_0_30px_rgba(99,102,241,0.4)] ring-1 ring-white/20 transition-all duration-300 ${isNevethonActive ? 'animate-pulse-fast ring-cyan-400 shadow-[0_0_50px_rgba(34,211,238,0.8)]' : ''}`}><LogoML/></div><div className="flex flex-col text-left"><h1 className="font-bold text-3xl tracking-tight text-white leading-none font-display">MultLives</h1><span className="text-[10px] uppercase tracking-[0.3em] text-gray-400 font-semibold mt-1 ml-0.5">Streaming Hub</span></div></div></div><div className="brand-back"><div className="relative flex items-center justify-center"><h2 className={`nevethon-text ${isNevethonActive ? 'animate-snow-shake drop-shadow-[0_0_20px_rgba(165,243,252,1)] text-cyan-100' : ''}`}>NEVETHON<span className="snow-particle" style={{left:'10%',animationDelay:'0s'}}></span><span className="snow-particle" style={{left:'30%',animationDelay:'0.4s'}}></span><span className="snow-particle" style={{left:'50%',animationDelay:'0.8s'}}></span><span className="snow-particle" style={{left:'70%',animationDelay:'0.2s'}}></span><span className="snow-particle" style={{left:'90%',animationDelay:'0.6s'}}></span></h2></div></div></div></div></div>)};
const LoadingScreen = ({ isLoading }) => {const [visible,setVisible]=useState(()=>!sessionStorage.getItem('nevethon_intro_seen'));const [phase,setPhase]=useState(0);useEffect(()=>{if(visible){sessionStorage.setItem('nevethon_intro_seen','true');const timer=setTimeout(()=>setPhase(1),3500);const removeTimer=setTimeout(()=>setVisible(false),4500);return ()=>{clearTimeout(timer);clearTimeout(removeTimer)}}},[visible]);if(!visible)return null;return(<div className={`fixed inset-0 z-[100] flex flex-col items-center justify-center bg-[#050507] transition-opacity duration-1000 ease-in-out ${phase===1?'opacity-0 pointer-events-none':'opacity-100'}`}><div className="absolute inset-0 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-[#1e293b] via-[#050507] to-[#000000] opacity-80"></div><div className="absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-20 brightness-150 pointer-events-none mix-blend-overlay"></div><div className="absolute inset-0 overflow-hidden pointer-events-none perspective-1000">{[...Array(60)].map((_,i)=>(<div key={i} className="absolute bg-white rounded-full animate-blizzard" style={{left:`${Math.random()*100}%`,top:`-${Math.random()*20}%`,width:`${Math.random()*3+1}px`,height:`${Math.random()*3+1}px`,opacity:Math.random()*0.8,animationDuration:`${Math.random()*2+3}s`,animationDelay:`${Math.random()*2}s`}}></div>))}</div><div className="relative z-10 text-center flex flex-col items-center justify-center gap-6 p-4 animate-slide-up"><div className="flex items-center gap-3 mb-2 opacity-80"><div className="h-[1px] w-8 md:w-16 bg-gradient-to-r from-transparent to-cyan-400"></div><p className="text-cyan-200 font-mono text-[10px] md:text-xs tracking-[0.4em] uppercase drop-shadow-md">Bem Vindo Ao</p><div className="h-[1px] w-8 md:w-16 bg-gradient-to-l from-transparent to-cyan-400"></div></div><div className="relative"><h1 className="font-russo text-6xl md:text-8xl lg:text-9xl tracking-tighter italic text-transparent bg-clip-text bg-gradient-to-b from-white via-cyan-200 to-blue-600 drop-shadow-[0_0_25px_rgba(34,211,238,0.6)] z-20 relative select-none pr-4">NEVETHON</h1><h1 className="absolute top-0 left-0 w-full h-full font-russo text-6xl md:text-8xl lg:text-9xl tracking-tighter italic text-cyan-500/30 blur-sm scale-105 select-none -z-10 pr-4" aria-hidden="true">NEVETHON</h1></div><div className="relative px-6 py-3 bg-[#09090b]/60 border border-cyan-500/20 rounded-full backdrop-blur-md flex items-center gap-3 shadow-[0_0_15px_rgba(34,211,238,0.1)] mt-4"><span className="text-cyan-300 text-xs">❄</span><p className="text-gray-300 font-bold tracking-[0.2em] text-[9px] md:text-xs uppercase">O Subathon Extremo dos Streamers</p><span className="text-cyan-300 text-xs">❄</span></div><div className="mt-8 w-48 h-[2px] bg-white/10 rounded-full overflow-hidden"><div className="h-full bg-cyan-400 shadow-[0_0_10px_rgba(34,211,238,1)] animate-[width_3.5s_ease-out_forwards]" style={{width:'0%'}}></div></div></div></div>)};
const getPlatformColor=p=>p==='twitch'?'text-[#9146ff]':p==='kick'?'text-[#53fc18]':p==='youtube'?'text-[#ff0000]':'text-white';
const getPlatformIcon=p=>p==='twitch'?<TwitchIcon/>:p==='kick'?<span className="text-[10px] font-bold">K</span>:p==='youtube'?<YoutubeIcon/>:null;
const PlatformSelector=({selected,onSelect})=>(<div className="flex items-center gap-1 mr-2 bg-white/5 rounded-full p-1 border border-white/5">{[{id:'twitch',bg:'bg-[#9146ff]',icon:<TwitchIcon/>},{id:'kick',bg:'bg-[#53fc18]',icon:<span className="font-bold text-[10px]">K</span>},{id:'youtube',bg:'bg-[#ff0000]',icon:<YoutubeIcon/>}].map(p=><button key={p.id} type="button" onClick={()=>onSelect(p.id)} className={`w-7 h-7 rounded-full flex items-center justify-center transition-all duration-300 ${selected===p.id?`${p.bg} text-black shadow-[0_0_10px_rgba(0,0,0,0.5)] scale-110`:'text-gray-500 hover:text-white hover:bg-white/10'}`} title={p.id}>{p.icon}</button>)}</div>);
const TwitchEmbed=memo(({channel,isMuted,parentDomain})=>{
    // Helper para construir a URL correta com todos os pais necessários
    const src = useMemo(() => {
        let loc = window.location.hostname;
        if (!loc || loc === 'about:srcdoc') loc = "localhost"; 

        const parents = new Set();
        parents.add(loc);
        parents.add("multlives.vercel.app");
        if (!loc.startsWith("www.")) parents.add(`www.${loc}`);
        if (loc.startsWith("www.")) parents.add(loc.replace("www.", ""));
        
        const parentQuery = Array.from(parents).map(p => `&parent=${p}`).join("");
        
        return `https://player.twitch.tv/?channel=${channel}${parentQuery}&muted=${isMuted}&autoplay=true`;
    }, [channel, isMuted]);

    return (
        <div className="w-full h-full relative bg-black group/twitch-embed">
            <iframe
                src={src}
                className="w-full h-full border-0"
                allowFullScreen
                scrolling="no"
                allow="autoplay; fullscreen; picture-in-picture; encrypted-media"
                title={`Twitch Stream ${channel}`}
            />
        </div>
    );
});
const StreamPlayer = memo(({ stream, index, widthClass, heightClass, style, isExpanded, onToggleFocus, onRemove, onRefresh, hostname, isGlobalMuted, soloStreamId, onToggleSolo, isResizingAny, isTheaterMode, onResizeStart, onResetSize, onContextMenu, twitchConfig, youtubeApiKey, isPatrolActive, expandedStreamId }) => {
    
    const isMuted=isPatrolActive?stream.id!==expandedStreamId:(soloStreamId&&soloStreamId!==stream.id)||(!soloStreamId&&isGlobalMuted);const isSolo=soloStreamId===stream.id;

    const renderPlayer=()=>{try{if(stream.platform==='kick'&&isPatrolActive&&stream.id!==expandedStreamId){return(<div className="w-full h-full relative">{stream.avatar?(<img src={stream.avatar} className="w-full h-full object-cover opacity-50"/>):(<div className="w-full h-full bg-[#0b0e11] flex items-center justify-center"><span className="text-[#53fc18] font-bold text-4xl opacity-20">K</span></div>)}<div className="absolute inset-0 flex items-center justify-center bg-black/40 backdrop-blur-sm"><span className="text-white/50 text-xs font-mono uppercase tracking-widest border border-white/20 px-2 py-1 rounded">Em Espera</span></div></div>)}if(stream.platform==='twitch'){return <TwitchEmbed key={stream.refreshKey} channel={stream.name} isMuted={isMuted} parentDomain={hostname}/>}else if(stream.platform==='kick'){return <iframe key={stream.refreshKey} src={`https://player.kick.com/${stream.name}?muted=${isMuted}&autoplay=true`} className="w-full h-full border-none" allowFullScreen></iframe>}else if(stream.platform==='youtube'){return <iframe key={stream.refreshKey} src={`https://www.youtube.com/embed/${stream.name}?autoplay=1&mute=${isMuted?1:0}`} className="w-full h-full border-none" allowFullScreen></iframe>}return null}catch(e){console.error("Erro render",e);return null}};return(<div className={`relative group bg-transparent overflow-hidden transition-all duration-500 ${!stream.customWidth?widthClass:''} ${heightClass||''} flex items-center justify-center p-1 z-10 max-w-[100vw]`} style={{flexGrow:0,width:stream.customWidth?`${stream.customWidth}px`:undefined,...style}} onContextMenu={e=>e.preventDefault()}><div onContextMenu={e=>onContextMenu(e,stream.id)} className={`relative bg-transparent transition-all duration-300 cinema-glow w-full aspect-video ${isExpanded?'ring-1 ring-white/20 cinema-glow-expanded shadow-2xl':''} ${isSolo?'ring-2 ring-accent shadow-[0_0_30px_rgba(99,102,241,0.5)]':''} ${isPatrolActive&&stream.id===expandedStreamId?'ring-2 ring-red-500/50 shadow-[0_0_40px_rgba(220,38,38,0.3)]':''}`}>{isResizingAny&&<div className="absolute inset-0 z-50 bg-transparent"></div>}{!isResizingAny&&<div className="absolute inset-0 z-[5] border-[20px] border-transparent pointer-events-none"></div>}{!isExpanded&&<div className="absolute bottom-0 right-0 w-16 h-16 z-40 cursor-nwse-resize opacity-0 group-hover:opacity-100 transition-opacity touch-none flex items-end justify-end pb-0 pr-0" onMouseDown={e=>onResizeStart(e,stream.id)} onTouchStart={e=>onResizeStart(e,stream.id)}><div className="w-8 h-8 bg-white/10 rounded-tl-xl border-r-2 border-b-2 border-white/50 hover:bg-white/20 active:bg-accent/40 transition-colors"></div></div>}
    
    {/* TOPO REORGANIZADO: Informações, Controles e Ajuda - Tudo aqui em cima para não bloquear nativos */}
    <div className={`absolute top-0 left-0 right-0 z-30 flex flex-col items-center p-2 bg-gradient-to-b from-black/90 via-black/60 to-transparent transition-opacity duration-200 pointer-events-none opacity-0 group-hover:opacity-100 gap-2`}>
        {/* Linha 1: Info e Botões Laterais */}
        <div className="w-full flex justify-between items-start relative z-40">
            <div className="px-2 py-1 bg-black/60 backdrop-blur-md rounded-md border border-white/10 flex items-center gap-2 pointer-events-auto max-w-[40%]">
                <span className={getPlatformColor(stream.platform)}>{getPlatformIcon(stream.platform)}</span>
                <span className="text-xs font-medium text-white shadow-sm truncate">{stream.name}</span>
            </div>
            <div className="flex gap-2 pointer-events-auto">
                 {stream.customWidth&&<button onClick={()=>onResetSize(stream.id)} className="p-1.5 bg-black/60 hover:bg-white/20 text-yellow-400 hover:text-white rounded-md border border-white/10 transition-all backdrop-blur-md" title="Resetar Tamanho"><ScaleIcon/></button>}
                 {stream.platform === 'twitch' && (
                    <button
                        onClick={() => alert("SOLUÇÃO TELA PRETA/ERRO #2000:\n\n1. Desative seu AdBlock (uBlock, AdGuard, etc).\n2. Navegadores como Brave/Opera GX podem bloquear scripts da Twitch.\n3. Desative 'Proteção contra Rastreamento' nas configurações do navegador.\n4. Limpe cookies/cache.\n\n5. Troque o DNS para 1.1.1.1 ou 8.8.8.8\n\nA Twitch bloqueia o player se não conseguir verificar a classificação etária devido a esses bloqueios.")}
                        className="flex items-center gap-1.5 p-1.5 bg-black/60 hover:bg-red-900/50 text-red-400 hover:text-red-200 rounded-md border border-white/10 transition-all backdrop-blur-md"
                        title="Tela Preta? Clique para solução (AdBlock)"
                    >
                        <AlertTriangleIcon width={14} height={14} />
                        <span className="text-[10px] font-bold whitespace-nowrap hidden md:inline">Ajuda</span>
                    </button>
                )}
            </div>
        </div>

        {/* Linha 2: Controles Principais Centralizados */}
        <div className="pointer-events-auto px-3 py-1.5 bg-[#09090b]/90 backdrop-blur-md border border-white/10 rounded-full shadow-2xl flex items-center gap-3 transform -translate-y-2 group-hover:translate-y-0 transition-transform duration-300 z-50">
             <button onClick={()=>onToggleSolo(stream.id)} className={`p-1.5 rounded-full transition-all ${isSolo?'bg-accent text-white shadow-[0_0_15px_rgba(99,102,241,0.6)] scale-110':'text-gray-400 hover:text-white hover:bg-white/10'}`} title={isSolo ? "Desativar Foco" : "Focar Áudio (Solo)"}>
                <HeadphonesIcon width={16} height={16}/>
             </button>
             <div className="w-px h-3 bg-white/10"></div>
             <button onClick={()=>onRefresh(stream.id)} className="p-1.5 text-gray-400 hover:text-blue-400 hover:bg-blue-400/10 rounded-full transition-all hover:scale-110" title="Recarregar Stream">
                <RefreshCwIcon width={16} height={16}/>
             </button>
             <button onClick={()=>onToggleFocus(stream.id)} className="p-1.5 text-gray-400 hover:text-indigo-400 hover:bg-indigo-400/10 rounded-full transition-all hover:scale-110" title={isExpanded ? "Restaurar" : "Maximizar"}>
                {isExpanded?<CompressIcon width={16} height={16}/>:<ExpandIcon width={16} height={16}/>}
             </button>
             <div className="w-px h-3 bg-white/10"></div>
             <button onClick={()=>onRemove(stream.id)} className="p-1.5 text-gray-400 hover:text-red-500 hover:bg-red-500/10 rounded-full transition-all hover:scale-110" title="Fechar Stream">
                <TrashIcon width={16} height={16}/>
             </button>
         </div>
    </div>
    
    <div className={`w-full h-full pointer-events-none md:pointer-events-auto bg-black ${isResizingAny?'pointer-events-none':''}`}>{renderPlayer()}</div></div></div>)},(p,n)=>p.stream.id===n.stream.id&&p.stream.refreshKey===n.stream.refreshKey&&p.widthClass===n.widthClass&&p.isExpanded===n.isExpanded&&p.stream.customWidth===n.stream.customWidth&&p.isResizingAny===n.isResizingAny&&p.isGlobalMuted===n.isGlobalMuted&&p.soloStreamId===n.soloStreamId&&p.isTheaterMode===n.isTheaterMode&&p.twitchConfig===n.twitchConfig&&p.youtubeApiKey===n.youtubeApiKey&&p.style?.height===n.style?.height&&p.isPatrolActive===n.isPatrolActive&&p.expandedStreamId===n.expandedStreamId);
const SquadsMenu=({isOpen,onClose,squads,currentStreamers,onSave,onLoad,onDelete,lang})=>{const [newSquadName,setNewSquadName]=useState(""),menuRef=useRef(null),t=(key)=>translations[lang][key];useEffect(()=>{const h=(e)=>{if(menuRef.current&&!menuRef.current.contains(e.target))onClose()};if(isOpen)document.addEventListener("mousedown",h);return ()=>document.removeEventListener("mousedown",h)},[isOpen,onClose]);if(!isOpen)return null;return(<div ref={menuRef} className="absolute bottom-16 left-1/2 -translate-x-1/2 w-72 bg-[#121215] border border-white/10 rounded-xl shadow-2xl p-4 animate-slide-up z-[70]"><div className="flex justify-between items-center mb-3"><h3 className="text-white font-bold text-sm flex items-center gap-2"><UsersIcon width={16}/> {t('squads_title')}</h3><button onClick={e=>{e.stopPropagation();onClose()}} className="text-gray-400 hover:text-white"><XIcon/></button></div><div className="flex gap-2 mb-4"><input type="text" placeholder={t('squad_name_ph')} value={newSquadName} onChange={e=>setNewSquadName(e.target.value)} className="flex-1 bg-white/5 border border-white/10 rounded-lg px-2 text-xs text-white focus:outline-none focus:border-accent"/><button onClick={e=>{e.stopPropagation();if(newSquadName){onSave(newSquadName);setNewSquadName("")}}} className="bg-accent hover:bg-accentHover text-white p-2 rounded-lg disabled:opacity-50" disabled={!newSquadName||currentStreamers.length===0} title={t('squad_save')}><SaveIcon/></button></div><div className="space-y-2 max-h-48 overflow-y-auto pr-1 scrollbar-hide">{squads.length===0&&<p className="text-center text-gray-600 text-xs italic">Nenhum squad</p>}{squads.map(sq=><div key={sq.id} className="flex items-center justify-between bg-white/5 p-2 rounded-lg group hover:bg-white/10 transition-colors"><div className="flex flex-col overflow-hidden"><span className="text-xs font-bold text-white truncate">{sq.name}</span><span className="text-[10px] text-gray-500">{sq.streams.length} streams</span></div><div className="flex gap-1"><button onClick={e=>{e.stopPropagation();onLoad(sq)}} className="p-1.5 text-ice hover:bg-ice/10 rounded"><LayoutIcon/></button><button onClick={e=>{e.stopPropagation();onDelete(sq.id)}} className="p-1.5 text-red-400 hover:bg-red-400/10 rounded"><TrashIcon/></button></div></div>)}</div></div>)};
const SleepTimerMenu=({isOpen,onClose,onSetTimer,activeTimer,lang})=>{const menuRef=useRef(null),t=(key)=>translations[lang][key];useEffect(()=>{const h=(e)=>{if(menuRef.current&&!menuRef.current.contains(e.target))onClose()};if(isOpen)document.addEventListener("mousedown",h);return ()=>document.removeEventListener("mousedown",h)},[isOpen,onClose]);if(!isOpen)return null;return(<div ref={menuRef} className="absolute bottom-16 left-1/2 -translate-x-1/2 bg-[#121215] border border-white/10 rounded-xl shadow-2xl p-2 animate-slide-up z-[70] flex flex-col gap-1 w-32"><div className="text-[10px] uppercase font-bold text-gray-500 px-2 py-1 mb-1 border-b border-white/5">{t('sleep_title')}</div>{[15,30,60,120,240].map(m=><button key={m} onClick={()=>{onSetTimer(m);onClose()}} className="text-left px-2 py-1.5 text-xs text-white hover:bg-white/10 rounded flex justify-between group"><span>{m<60?`${m} min`:`${m/60} h`}</span>{activeTimer===m&&<span className="text-ice">●</span>}</button>)}{activeTimer&&<button onClick={()=>{onSetTimer(null);onClose()}} className="text-left px-2 py-1.5 text-xs text-red-400 hover:bg-red-400/10 rounded border-t border-white/5 mt-1">Desativar</button>}</div>)};
const PatrolMenu=({isOpen,onClose,isPatrolActive,togglePatrol,patrolDuration,setPatrolDuration,patrolSwitchChat,setPatrolSwitchChat,setShowPatrolChatInfo,lang})=>{const menuRef=useRef(null),t=(key)=>translations[lang][key];useEffect(()=>{const h=(e)=>{if(menuRef.current&&!menuRef.current.contains(e.target))onClose()};if(isOpen)document.addEventListener("mousedown",h);return ()=>document.removeEventListener("mousedown",h)},[isOpen,onClose]);if(!isOpen)return null;return(<div ref={menuRef} className="absolute bottom-16 left-1/2 -translate-x-1/2 bg-[#121215] border border-white/10 rounded-xl shadow-2xl p-4 animate-slide-up z-[70] w-64"><div className="flex justify-between items-center mb-3"><div className="flex items-center gap-2"><div className={`w-2 h-2 rounded-full ${isPatrolActive?'bg-green-500 animate-pulse':'bg-gray-600'}`}></div><h3 className="text-white font-bold text-sm">{t('patrol_title')}</h3></div><button onClick={e=>{e.stopPropagation();onClose()}} className="text-gray-400 hover:text-white"><XIcon/></button></div><p className="text-[10px] text-gray-400 mb-4 leading-relaxed bg-white/5 p-2 rounded border border-white/5">{t('patrol_desc')}</p><div className="flex flex-col gap-2"><div className="flex items-center justify-between bg-white/5 p-2 rounded mb-1 border border-white/5"><span className="text-[11px] font-bold text-gray-300">{t('patrol_chat_switch')}</span><button onClick={()=>{if(!patrolSwitchChat)setShowPatrolChatInfo(true);setPatrolSwitchChat(!patrolSwitchChat)}} className={`w-9 h-5 rounded-full relative transition-colors border border-white/10 ${patrolSwitchChat?'bg-green-500/80':'bg-black/50'}`}><div className={`absolute top-0.5 w-3.5 h-3.5 bg-white rounded-full transition-transform shadow-sm ${patrolSwitchChat?'translate-x-[18px]':'translate-x-[2px]'}`}></div></button></div><div className="text-[10px] uppercase font-bold text-gray-500 mb-1 mt-2">Intervalo de Troca</div><div className="flex gap-2">{[10, 30, 60].map(sec=>(<button key={sec} onClick={()=>setPatrolDuration(sec)} className={`flex-1 py-1.5 rounded text-xs font-bold transition-all border ${patrolDuration===sec?'bg-ice/20 text-ice border-ice/50':'bg-white/5 text-gray-400 border-transparent hover:bg-white/10'}`}>{sec}s</button>))}</div><button onClick={togglePatrol} className={`mt-3 w-full py-2 rounded-lg text-xs font-bold flex items-center justify-center gap-2 transition-all ${isPatrolActive?'bg-red-500/20 text-red-400 border border-red-500/50 hover:bg-red-500/30':'bg-green-500 text-black hover:bg-green-400'}`}>{isPatrolActive?'Parar Ronda':'Iniciar Ronda Automática'}</button></div></div>)};
const CustomContextMenu=({menu,onClose,onAction,lang})=>{const menuRef=useRef(null),t=(key)=>translations[lang][key];useEffect(()=>{const h=(e)=>{if(menuRef.current&&!menuRef.current.contains(e.target))onClose()};document.addEventListener("mousedown",h);return ()=>document.removeEventListener("mousedown",h)},[onClose]);if(!menu.isOpen)return null;return(<div ref={menuRef} style={{top:menu.y,left:menu.x}} className="fixed z-[100] w-48 bg-[#121215]/95 backdrop-blur-md border border-white/10 rounded-lg shadow-2xl py-1 animate-fade-in flex flex-col"><button onClick={()=>onAction('focus',menu.streamId)} className="flex items-center gap-3 px-3 py-2 text-xs text-white hover:bg-white/10 text-left"><LayoutTemplateIcon width={14}/> {t('ctx_focus')}</button><button onClick={()=>onAction('refresh',menu.streamId)} className="flex items-center gap-3 px-3 py-2 text-xs text-white hover:bg-white/10 text-left"><RefreshCwIcon width={14}/> {t('ctx_refresh')}</button><button onClick={()=>onAction('copy',menu.streamId)} className="flex items-center gap-3 px-3 py-2 text-xs text-white hover:bg-white/10 text-left"><CopyIcon width={14}/> {t('ctx_copy')}</button><div className="h-[1px] bg-white/5 my-1"></div><button onClick={()=>onAction('close',menu.streamId)} className="flex items-center gap-3 px-3 py-2 text-xs text-red-400 hover:bg-red-500/10 text-left"><TrashIcon width={14}/> {t('ctx_close')}</button></div>)};
const PatrolChatInfoModal=({isOpen,onClose,lang})=>{if(!isOpen)return null;return(<div className="fixed inset-0 z-[110] flex items-center justify-center bg-black/60 backdrop-blur-sm animate-fade-in" onClick={onClose}><div className="bg-[#121215] border border-white/10 p-6 rounded-xl shadow-2xl max-w-sm mx-4 relative" onClick={e=>e.stopPropagation()}><div className="w-12 h-12 bg-green-500/10 rounded-full flex items-center justify-center mb-4 border border-green-500/20 text-green-500 mx-auto"><ChatIcon width={24} height={24}/></div><h3 className="text-white font-bold text-center mb-2">Sincronização de Chat Ativada</h3><p className="text-gray-400 text-xs text-center leading-relaxed mb-6">Agora o chat da barra lateral trocará automaticamente para acompanhar o streamer que estiver em destaque no Modo Ronda.</p><button onClick={onClose} className="w-full py-2.5 bg-white text-black font-bold rounded-lg hover:bg-gray-200 transition-colors text-sm">Entendi</button></div></div>)};
const App=()=>{const [streamers,setStreamers]=useState([]),[inputVal,setInputVal]=useState(""),[platform,setPlatform]=useState("twitch"),[isSidebarOpen,setIsSidebarOpen]=useState(()=>typeof window!=='undefined'?window.innerWidth>768:true);const [activeChatTab,setActiveChatTab]=useState(null),[isHeaderVisible,setIsHeaderVisible]=useState(true),[secondaryChatTab,setSecondaryChatTab]=useState(null),[showMap,setShowMap]=useState(false);const [expandedStreamId,setExpandedStreamId]=useState(null),[isTheaterMode,setIsTheaterMode]=useState(false),[loading,setLoading]=useState(true),[sidebarWidth,setSidebarWidth]=useState(340);const [isResizing,setIsResizing]=useState(false),[isGlobalMuted,setIsGlobalMuted]=useState(false),[mapHeight,setMapHeight]=useState(300),[isResizingMap,setIsResizingMap]=useState(false);const [lang,setLang]=useState('pt'),[layoutMode,setLayoutMode]=useState('auto'),[squads,setSquads]=useState([]),[showSquadMenu,setShowSquadMenu]=useState(false),[showSleepMenu,setShowSleepMenu]=useState(false);const [showDonatePopup,setShowDonatePopup]=useState(false),[chatRefreshTriggers,setChatRefreshTriggers]=useState({}),[isToolbarActive,setIsToolbarActive]=useState(false);const [resizingStreamId,setResizingStreamId]=useState(null),[pipWindow,setPipWindow]=useState(null),[searchHistory,setSearchHistory]=useState([]),[showHistory,setShowHistory]=useState(false);const [contextMenu,setContextMenu]=useState({isOpen:false,x:0,y:0,streamId:null}),[sleepTimer,setSleepTimer]=useState({active:false,endTime:null,duration:null});const [soloStreamId,setSoloStreamId]=useState(null);const [isPatrolActive,setIsPatrolActive]=useState(false);const [patrolDuration,setPatrolDuration]=useState(30);const [patrolTimeLeft,setPatrolTimeLeft]=useState(30);const [showPatrolMenu,setShowPatrolMenu]=useState(false);const [patrolSwitchChat,setPatrolSwitchChat]=useState(false);const [showPatrolChatInfo,setShowPatrolChatInfo]=useState(false);const [showSettings,setShowSettings]=useState(false);const [showTour,setShowTour]=useState(false);const [twitchConfig,setTwitchConfig]=useState(()=>{const s=localStorage.getItem('multlives-twitch-config');return s?JSON.parse(s):{clientId:'',token:''}});const [youtubeApiKey,setYoutubeApiKey]=useState(()=>localStorage.getItem('multlives-yt-key')||'');const headerTimerRef=useRef(null),toolbarTimeoutRef=useRef(null),{toasts,addToast}=useToast(),sidebarRef=useRef(null);const startResizeX=useRef(0),startResizeWidth=useRef(0);const hostname=typeof window!=='undefined'&&window.location.hostname?window.location.hostname:"localhost",t=(key)=>translations[lang][key];const lastCloseRef=useRef(0);
const [isNevethonActive, setIsNevethonActive] = useState(false);
const [isInputFocused, setIsInputFocused] = useState(false);
const resizeRafRef = useRef(null);

// Estado e Refs para o movimento do menu (Toolbar)
const [toolbarPos,setToolbarPos]=useState({x:0,y:0});const toolbarDragStart=useRef(null);
const [isToolbarPinned, setIsToolbarPinned] = useState(true); // Default true

const onToolbarTouchStart=(e)=>{const touch=e.touches[0];toolbarDragStart.current={x:touch.clientX-toolbarPos.x,y:touch.clientY-toolbarPos.y}};
const onToolbarTouchMove=(e)=>{if(!toolbarDragStart.current)return;const touch=e.touches[0];setToolbarPos({x:touch.clientX-toolbarDragStart.current.x,y:touch.clientY-toolbarDragStart.current.y})};
const onToolbarTouchEnd=()=>{toolbarDragStart.current=null};

// Desktop Drag Logic for Toolbar
const handleToolbarMouseDown = (e) => {
    // Evita iniciar o drag se clicar em um botão
    if (e.target.closest('button')) return;
    
    e.preventDefault();
    toolbarDragStart.current = { x: e.clientX - toolbarPos.x, y: e.clientY - toolbarPos.y };
    
    const onMouseMove = (moveEvent) => {
        if (!toolbarDragStart.current) return;
        setToolbarPos({
            x: moveEvent.clientX - toolbarDragStart.current.x,
            y: moveEvent.clientY - toolbarDragStart.current.y
        });
    };

    const onMouseUp = () => {
        toolbarDragStart.current = null;
        window.removeEventListener('mousemove', onMouseMove);
        window.removeEventListener('mouseup', onMouseUp);
    };

    window.addEventListener('mousemove', onMouseMove);
    window.addEventListener('mouseup', onMouseUp);
};

useEffect(()=>{const h=(e)=>{const isOverSidebar=isSidebarOpen&&window.innerWidth>=768&&e.clientX>(window.innerWidth-sidebarWidth);if((e.clientY<120&&!isOverSidebar)||streamers.length===0){setIsHeaderVisible(true);if(headerTimerRef.current)clearTimeout(headerTimerRef.current)}else if(streamers.length>0&&!isTheaterMode&&isHeaderVisible){if(headerTimerRef.current)clearTimeout(headerTimerRef.current);headerTimerRef.current=setTimeout(()=>setIsHeaderVisible(false),1500)}};window.addEventListener('mousemove',h);return ()=>{window.removeEventListener('mousemove',h);if(headerTimerRef.current)clearTimeout(headerTimerRef.current)}},[streamers.length,isTheaterMode,isHeaderVisible,isSidebarOpen,sidebarWidth]);useEffect(()=>{setTimeout(()=>setLoading(false),4500);const s=localStorage.getItem('multlives-streamers');if(s){try{const p=JSON.parse(s);const c=Array.isArray(p)?p.filter(x=>x&&x.id&&x.name):[];setStreamers(c);if(c.length)setActiveChatTab(c[0].id);c.forEach(async(st)=>{if(!st.avatar){const url=await fetchAvatar(st.platform,st.name);if(url)setStreamers(prev=>prev.map(s=>s.id===ns.id?{...s,avatar:url}:s))}})}catch{}}const sq=localStorage.getItem('multlives-squads');if(sq)setSquads(JSON.parse(sq));const h=localStorage.getItem('multlives-history');if(h)setSearchHistory(JSON.parse(h));const d=setTimeout(()=>setShowDonatePopup(true),15000);return ()=>clearTimeout(d)},[]);useEffect(()=>{const tourSeen=localStorage.getItem('multlives-tour-seen');if(!tourSeen){setTimeout(()=>setShowTour(true),5000)}},[]);useEffect(()=>localStorage.setItem('multlives-streamers',JSON.stringify(streamers)),[streamers]);useEffect(()=>localStorage.setItem('multlives-squads',JSON.stringify(squads)),[squads]);useEffect(()=>localStorage.setItem('multlives-history',JSON.stringify(searchHistory)),[searchHistory]);useEffect(()=>localStorage.setItem('multlives-twitch-config',JSON.stringify(twitchConfig)),[twitchConfig]);useEffect(()=>localStorage.setItem('multlives-yt-key',youtubeApiKey),[youtubeApiKey]);useEffect(()=>{if(!isPatrolActive||streamers.length<2)return;setPatrolTimeLeft(patrolDuration);if(!expandedStreamId){setExpandedStreamId(streamers[0].id);setLayoutMode('focus')}const switchInterval=setInterval(()=>{setExpandedStreamId(prevId=>{const currentIndex=streamers.findIndex(s=>s.id===prevId);const nextIndex=(currentIndex+1)%streamers.length;const nextId=streamers[nextIndex].id;if(patrolSwitchChat){setActiveChatTab(nextId)}return nextId});setPatrolTimeLeft(patrolDuration)},patrolDuration*1000);const countdownInterval=setInterval(()=>{setPatrolTimeLeft(prev=>prev>0?prev-1:0)},1000);return ()=>{clearInterval(switchInterval);clearInterval(countdownInterval)}},[isPatrolActive,patrolDuration,streamers,expandedStreamId,patrolSwitchChat]);const startResizing=useCallback(e=>{if(e.type==='mousedown')e.preventDefault();setIsResizing(true)},[]),startMapResizing=useCallback(e=>{if(e.type==='mousedown')e.preventDefault();setIsResizingMap(true)},[]),stopResizing=useCallback(()=>{setIsResizing(false);setIsResizingMap(false);setResizingStreamId(null);if(resizeRafRef.current)cancelAnimationFrame(resizeRafRef.current)},[]);

const handleStreamResizeStart=(e,id)=>{
    e.preventDefault(); 
    e.stopPropagation();
    const clientX = e.type==='mousedown' ? e.clientX : e.touches[0].clientX;
    startResizeX.current = clientX;
    setResizingStreamId(id);
    const element = e.target.closest('.group');
    const currentRectWidth = element ? element.getBoundingClientRect().width : 300;
    startResizeWidth.current = currentRectWidth;
    setStreamers(prev => prev.map(s => s.id === id ? {...s, customWidth: currentRectWidth} : s));
};

const resize = useCallback((e) => {
    if (!isResizing && !isResizingMap && !resizingStreamId) return;

    if(resizeRafRef.current) cancelAnimationFrame(resizeRafRef.current);

    resizeRafRef.current = requestAnimationFrame(() => {
        const cX = e.type.startsWith('touch') ? e.touches[0].clientX : e.clientX;
        const cY = e.type.startsWith('touch') ? e.touches[0].clientY : e.clientY;

        if (isResizing) {
            setSidebarWidth(Math.max(250, Math.min(window.innerWidth * 0.8, window.innerWidth - cX)));
        }
        
        if (isResizingMap && sidebarRef.current) {
            setMapHeight(Math.max(100, Math.min(sidebarRef.current.getBoundingClientRect().height - 150, cY - sidebarRef.current.getBoundingClientRect().top)));
        }

        if (resizingStreamId) {
            const deltaX = cX - startResizeX.current;
            const newWidth = Math.max(200, startResizeWidth.current + deltaX);
            setStreamers(p => p.map(s => s.id === resizingStreamId ? { ...s, customWidth: newWidth } : s));
        }
    });
}, [isResizing, isResizingMap, resizingStreamId]);

useEffect(()=>{window.addEventListener("mousemove",resize);window.addEventListener("mouseup",stopResizing);window.addEventListener("touchmove",resize,{passive:false});window.addEventListener("touchend",stopResizing);return ()=>{window.removeEventListener("mousemove",resize);window.removeEventListener("mouseup",stopResizing);window.removeEventListener("touchmove",resize);window.removeEventListener("touchend",stopResizing)}},[resize,stopResizing]);const togglePip=useCallback(async()=>{if(pipWindow){pipWindow.close();setPipWindow(null);return}const copyStyles=(targetDoc)=>{[...document.styleSheets].forEach((styleSheet)=>{try{if(styleSheet.cssRules){const newStyle=targetDoc.createElement('style');[...styleSheet.cssRules].forEach(rule=>newStyle.appendChild(targetDoc.createTextNode(rule.cssText)));targetDoc.head.appendChild(newStyle)}else if(styleSheet.href){const newLink=targetDoc.createElement('link');newLink.rel='stylesheet';newLink.href=styleSheet.href;targetDoc.head.appendChild(newLink)}}catch(e){if(styleSheet.ownerNode)targetDoc.head.appendChild(styleSheet.ownerNode.cloneNode(true))}});const twScript=document.querySelector('script[src*="tailwindcss"]');if(twScript){const s=targetDoc.createElement('script');s.src=twScript.src;targetDoc.head.appendChild(s)}targetDoc.body.className="bg-[#09090b] text-white overflow-hidden"};if(typeof window!=='undefined'&&window.documentPictureInPicture){try{const w=await window.documentPictureInPicture.requestWindow({width:800,height:600});copyStyles(w.document);w.addEventListener("pagehide",()=>setPipWindow(null));setPipWindow(w);return}catch(err){console.error("Pip Error:",err)}}try{const w=window.open("","_blank","width=800,height=600,menubar=no,toolbar=no,location=no,status=no,resizable=yes,scrollbars=yes");if(!w){addToast("Pop-up bloqueado. Permita para usar.",'error');return}setTimeout(()=>{w.document.title="MultLives - Player Flutuante";copyStyles(w.document);const timer=setInterval(()=>{if(w.closed){clearInterval(timer);setPipWindow(null)}},500);w.addEventListener("beforeunload",()=>{setPipWindow(null)});setPipWindow(w)},100)}catch(err){console.error("Popup Fallback Error:",err);addToast("Erro ao abrir janela.",'error')}},[pipWindow,t,addToast]);const toggleTheaterMode=()=>setIsTheaterMode(p=>!p);const addStreamer=async(e)=>{e.preventDefault();if(!inputVal.trim())return addToast(t('toast_empty'),'info');let n=inputVal.trim();if(platform==='youtube'){const m=n.match(/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?|live)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/);if(m&&m[1])n=m[1];else{const m2=n.match(/^([a-zA-Z0-9_-]{11})$/);if(!m2)return addToast("Link/ID do YouTube inválido!",'error')}}else n=n.toLowerCase();if(streamers.some(s=>s.name===n&&s.platform===platform))return addToast(t('toast_exists'),'error');const ns={id:Date.now().toString(),name:n,platform,refreshKey:Date.now(),customWidth:null,avatar:null};setStreamers(p=>[...p,ns]);setSearchHistory(p=>{const historyItem={name:n,platform};const f=p.filter(x=>!(x.name===historyItem.name&&x.platform===historyItem.platform));return [historyItem,...f].slice(0,5)});setInputVal("");if(!streamers.length)setActiveChatTab(ns.id);addToast(t('toast_added'),'success');const avatarUrl=await fetchAvatar(platform,n);if(avatarUrl)setStreamers(prev=>prev.map(s=>s.id===ns.id?{...s,avatar:avatarUrl}:s))};const removeStreamer=(id)=>{if(expandedStreamId===id)setExpandedStreamId(null);setStreamers(p=>{const n=p.filter(x=>x.id!==id);if(activeChatTab===id)setActiveChatTab(n[0]?.id||null);return n})};const changeLayout=(m)=>{setLayoutMode(m);if(m==='auto'||m==='grid'){setStreamers(p=>p.map(s=>({...s,customWidth:null})));setIsPatrolActive(false)}setExpandedStreamId(m==='focus'&&streamers.length?streamers[0].id:null)};const handleContextAction=(a,sid)=>{setContextMenu({...contextMenu,isOpen:false});const s=streamers.find(x=>x.id===sid);if(!s&&a!=='close')return;switch(a){case 'refresh':setStreamers(p=>p.map(x=>x.id===sid?{...x,refreshKey:Date.now()}:x));break;case 'focus':if(expandedStreamId!==sid)setActiveChatTab(sid);setExpandedStreamId(p=>p===sid?null:sid);break;case 'copy':const u=s.platform==='twitch'?`https://twitch.tv/${s.name}`:s.platform==='kick'?`https://kick.com/${s.name}`:`https://youtube.com/watch?v=${s.name}`;navigator.clipboard.writeText(u);addToast("Link copiado!",'success');break;case 'close':removeStreamer(sid);break}};const renderStreamItem=(s,i,w,h,exp=false,extraStyle={})=>s?<StreamPlayer key={s.id} stream={s} index={i} widthClass={w} heightClass={h} style={extraStyle} isExpanded={exp} onToggleFocus={id=>{if(expandedStreamId!==id)setActiveChatTab(id);setExpandedStreamId(p=>p===id?null:id)}} onRemove={removeStreamer} onRefresh={id=>setStreamers(p=>p.map(x=>x.id===id?{...x,refreshKey:Date.now()}:x))} hostname={hostname} isGlobalMuted={isGlobalMuted} soloStreamId={soloStreamId} onToggleSolo={id=>setSoloStreamId(p=>p===id?null:id)} isResizingAny={isResizing||isResizingMap||resizingStreamId!==null} isTheaterMode={isTheaterMode} onResizeStart={handleStreamResizeStart} onResetSize={id=>setStreamers(p=>p.map(x=>x.id===id?{...x,customWidth:null}:x))} onContextMenu={(e,sid)=>{e.preventDefault();let x=e.clientX,y=e.clientY;if(x+192>window.innerWidth)x=window.innerWidth-192-10;if(y+160>window.innerHeight)y=window.innerHeight-160-10;setContextMenu({isOpen:true,x,y,streamId:sid})}} twitchConfig={twitchConfig} youtubeApiKey={youtubeApiKey} isPatrolActive={isPatrolActive} expandedStreamId={expandedStreamId} />:null;const renderStreams=()=>{const isFocusMode=!!expandedStreamId&&streamers.some(s=>s.id===expandedStreamId);if(isFocusMode){const expandedStream=streamers.find(s=>s.id===expandedStreamId);const expandedIndex=streamers.findIndex(s=>s.id===expandedStreamId);const sideStreams=streamers.map((s,i)=>({s,i})).filter(item=>item.s.id!==expandedStreamId);return(<div className="w-full h-full flex flex-col md:flex-row bg-transparent overflow-hidden"><div className="flex-1 min-w-0 min-h-0 relative order-1 md:order-1 flex items-center justify-center bg-transparent p-1 md:p-0">{renderStreamItem(expandedStream,expandedIndex,"w-full h-full max-h-full aspect-video shadow-2xl rounded-lg md:rounded-none","h-full",true,{width:'100%',height:'100%'})}</div>{sideStreams.length>0&&(<div className="w-full md:w-[320px] h-32 md:h-full bg-surface/30 border-t md:border-t-0 md:border-l border-white/5 flex flex-row md:flex-col items-center md:justify-center p-2 gap-2 order-2 md:order-2 shrink-0 overflow-x-auto md:overflow-y-auto md:overflow-x-hidden scrollbar-hide snap-x z-20">{sideStreams.map(({s,i})=>renderStreamItem(s,i,"w-[160px] md:w-full shrink-0 snap-center","aspect-video",false,{width:'100%'}))}</div>)}</div>)}const cnt=streamers.length;const getW=i=>{
    const isMobileLandscape = typeof window !== 'undefined' && window.innerWidth < 900 && window.innerWidth > window.innerHeight;
    const mobileFull="w-full";
    const mobileHalf="w-[calc(50%-0.25rem)]"; 
    if(layoutMode==='grid'){
        if(cnt<=1)return mobileFull;
        if(cnt===2)return isMobileLandscape ? mobileHalf : `${mobileFull} md:w-[calc(50%-1rem)]`;
        if(cnt<=4)return `${mobileHalf} md:w-[calc(50%-1rem)]`; 
        return `${mobileHalf} md:w-[calc(33.33%-1rem)]`;
    }
    if(cnt<=1)return mobileFull;
    if(cnt===2)return isMobileLandscape ? mobileHalf : `${mobileFull} md:w-[calc(50%-1rem)]`;
    if(cnt>=3)return `${mobileHalf} md:w-[calc(33.33%-1rem)]`; 
    return `${mobileFull} md:w-[calc(50%-1rem)]`;
};
return(
    <div className="w-full h-full overflow-y-auto scrollbar-hide z-20 relative overscroll-y-contain touch-pan-y" style={{WebkitOverflowScrolling:'touch'}}>
        <div className="min-h-full w-full flex flex-wrap justify-center content-center items-center gap-3 md:gap-4 px-4 py-20 md:py-24 transition-all duration-300">
            {streamers.map((s,i)=>renderStreamItem(s,i,getW(i),"h-auto",false))}
        </div>
    </div>
)};const renderContent=()=>pipWindow?createPortal(<div className="h-full w-full bg-[#09090b] flex flex-col">{renderStreams()}</div>,pipWindow.document.body)||<div className="flex-1 flex flex-col items-center justify-center p-8 text-center animate-fade-in"><div className="w-24 h-24 bg-white/5 rounded-full flex items-center justify-center mb-6 animate-pulse-glow"><ExternalLinkIcon width={48} height={48} className="text-ice"/></div><h2 className="text-2xl font-bold text-white mb-2">{t('pip_active')}</h2><p className="text-gray-400 max-w-sm mb-8">{t('pip_desc')}</p><button onClick={togglePip} className="px-6 py-3 bg-white/10 hover:bg-white/20 border border-white/20 rounded-full text-white font-bold hover:scale-105">{t('pip_bring_back')}</button></div>:renderStreams();
const openNevethon = () => {
    const nevethonStreams = [
        {id: 'nev-1', name: 'jonvlogs', platform: 'twitch', refreshKey: Date.now(), customWidth: null, avatar: null},
        {id: 'nev-2', name: 'sheviii2k', platform: 'twitch', refreshKey: Date.now(), customWidth: null, avatar: null},
        {id: 'nev-3', name: 'linsjr', platform: 'twitch', refreshKey: Date.now(), customWidth: null, avatar: null},
        {id: 'nev-4', name: 'stereonline', platform: 'kick', refreshKey: Date.now(), customWidth: null, avatar: null},
        {id: 'nev-3', name: 'kazhar_3', platform: 'twitch', refreshKey: Date.now(), customWidth: null, avatar: null},
    ];
    setStreamers(nevethonStreams);
    setIsNevethonActive(true);
    setLayoutMode('grid');
    setActiveChatTab('nev-1'); // Default chat
    addToast("Modo NEVETHON Ativado! ❄️", "success");
    
    nevethonStreams.forEach(async(st)=>{
        const url=await fetchAvatar(st.platform,st.name);
        if(url)setStreamers(prev=>prev.map(s=>s.id===st.id?{...s,avatar:url}:s))
    });
};

return(<div onContextMenu={e=>e.preventDefault()} className={`flex flex-col h-screen transition-all duration-700 ${isTheaterMode?'bg-[#020203] theater-mode-active':'bg-background'} ${(!isHeaderVisible&&streamers.length&&!isTheaterMode)?'header-hidden-active':''} text-gray-100 font-sans relative overflow-hidden`}><div className="blackout-overlay"></div><SettingsModal isOpen={showSettings} onClose={()=>setShowSettings(false)} twitchConfig={twitchConfig} setTwitchConfig={setTwitchConfig} youtubeApiKey={youtubeApiKey} setYoutubeApiKey={setYoutubeApiKey} lang={lang}/><CustomContextMenu menu={contextMenu} onClose={()=>setContextMenu({...contextMenu,isOpen:false})} onAction={handleContextAction} lang={lang}/><LoadingScreen isLoading={loading} lang={lang}/><ToastContainer toasts={toasts}/><button onClick={()=>setLang(l=>l==='pt'?'en':'pt')} className="fixed top-4 left-4 z-[60] bg-white/10 hover:bg-white/20 backdrop-blur-md rounded-full px-3 py-1.5 text-xs font-bold text-white/80 border border-white/5 active:scale-95">{lang==='pt'?'🇺🇸 EN':'🇧🇷 PT'}</button>{showTour&&<TourGuide onFinish={()=>{setShowTour(false);localStorage.setItem('multlives-tour-seen','true')}} lang={lang}/>}{showDonatePopup&&<DonatePopup onClose={()=>setShowDonatePopup(false)}/>}
<Credits isSidebarOpen={isSidebarOpen} sidebarWidth={sidebarWidth}/>
<PatrolChatInfoModal isOpen={showPatrolChatInfo} onClose={()=>setShowPatrolChatInfo(false)} lang={lang}/>
<div className="absolute inset-0 z-0 pointer-events-none overflow-hidden"><div className="absolute top-[-10%] left-[-10%] w-[50%] h-[50%] rounded-full bg-ice/20 blur-[120px] animate-aurora-1 mix-blend-screen animate-audio-pulse-slow"></div><div className="absolute bottom-[-10%] right-[-10%] w-[50%] h-[50%] rounded-full bg-accent/20 blur-[120px] animate-aurora-2 mix-blend-screen animate-audio-pulse-fast"></div></div>{(isResizing||isResizingMap||resizingStreamId)&&<div className="fixed inset-0 z-50 cursor-col-resize select-none bg-transparent"></div>}<div className="header-trigger-area" style={{right:(isSidebarOpen&&typeof window!=='undefined'&&window.innerWidth>=768)?sidebarWidth:0}}></div><HeroBrand minimized={streamers.length>0} isNevethonActive={isNevethonActive}/>
<div className="command-bar-container"><div className="command-bar group/command"><PlatformSelector selected={platform} onSelect={setPlatform}/>
    <button
        type="button"
        onClick={openNevethon}
        className={`flex items-center gap-2 bg-gradient-to-r from-cyan-500 to-blue-600 text-white font-bold text-[10px] md:text-xs rounded-full shadow-[0_0_15px_rgba(34,211,238,0.4)] hover:shadow-[0_0_25px_rgba(34,211,238,0.6)] hover:scale-105 transition-all duration-500 ease-[cubic-bezier(0.4,0,0.2,1)] overflow-hidden whitespace-nowrap border border-white/20 shrink-0 ${isInputFocused ? 'w-0 opacity-0 px-0 scale-0 !m-0' : 'w-auto px-3 py-1.5 md:py-2 opacity-100 scale-100'}`}
    >
        <span className="animate-pulse">❄️</span>
        <span className="font-russo tracking-wide italic">NEVETHON</span>
    </button>
<form onSubmit={addStreamer} className="flex-1 flex items-center h-full relative group/input min-w-0 gap-2"><div className="flex-1 relative h-full flex items-center"><SearchIcon className="absolute left-2 text-gray-500 w-4 h-4 group-focus-within/input:text-white transition-colors"/><input type="text" value={inputVal} onChange={e=>setInputVal(e.target.value)} onFocus={()=>{setShowHistory(true);setIsInputFocused(true)}} onBlur={()=>{setTimeout(()=>setShowHistory(false),200);setIsInputFocused(false)}} placeholder={platform==='twitch'?t('placeholder_twitch'):platform==='kick'?t('placeholder_kick'):platform==='youtube'?t('placeholder_yt'):t('placeholder_default')} className="w-full h-full bg-transparent text-sm pl-8 pr-2 focus:outline-none text-white placeholder-gray-500 font-medium"/>{showHistory&&searchHistory.length>0&&(<div className="absolute top-full left-0 right-0 mt-2 bg-[#121215] border border-white/10 rounded-xl shadow-2xl overflow-hidden z-50 animate-slide-up"><div className="px-3 py-2 text-[10px] uppercase font-bold text-gray-500 bg-white/5 flex justify-between items-center border-b border-white/5"><span>{t('history')}</span><button onMouseDown={e=>{e.preventDefault();setSearchHistory([])}} className="hover:text-red-400 transition-colors flex items-center gap-1"><TrashIcon width={10} height={10}/> {t('history_clear')}</button></div>{searchHistory.map((item,idx)=><button key={`${item.platform}-${item.name}-${idx}`} onMouseDown={e=>{e.preventDefault();setInputVal(item.name);setPlatform(item.platform);setShowHistory(false)}} className="w-full text-left px-3 py-2.5 text-xs text-white hover:bg-white/10 flex items-center gap-3 group/item border-b last:border-0 border-white/5 transition-colors"><span className={`flex items-center justify-center w-5 h-5 rounded-md bg-white/5 ${getPlatformColor(item.platform)}`}>{getPlatformIcon(item.platform)}</span><span className="font-medium group-hover/item:text-ice transition-colors">{item.name}</span></button>)}</div>)}</div><button type="submit" className="w-10 h-10 rounded-full bg-white text-black flex items-center justify-center hover:bg-gray-200 shadow-lg active:scale-95 shrink-0" title={t('add_btn')}><PlusIcon/></button></form></div></div>
<div className="floating-toolbar-trigger fixed bottom-0 z-50 transition-all duration-300" onMouseEnter={() => {if(!isToolbarPinned) setIsToolbarActive(true);}} style={{left:0,right:isSidebarOpen&&typeof window!=='undefined'&&window.innerWidth>=768?`${sidebarWidth}px`:0,height:'40px'}}></div>
<div className={`toolbar-flip-container transition-opacity duration-500 ${!isToolbarPinned && !isToolbarActive && !showSquadMenu && !showSleepMenu && !showPatrolMenu ? 'opacity-0 translate-y-full pointer-events-none' : 'opacity-100 translate-y-0'}`} onMouseEnter={()=>{if(Date.now()-lastCloseRef.current<2500)return;if(toolbarTimeoutRef.current)clearTimeout(toolbarTimeoutRef.current);setIsToolbarActive(true)}} onMouseLeave={()=>{if(!isToolbarPinned) toolbarTimeoutRef.current=setTimeout(()=>setIsToolbarActive(false),800)}} onTouchStart={onToolbarTouchStart} onTouchMove={onToolbarTouchMove} onTouchEnd={onToolbarTouchEnd} onMouseDown={handleToolbarMouseDown} style={{marginLeft:isSidebarOpen&&typeof window!=='undefined'&&window.innerWidth>=768?`-${sidebarWidth/2}px`:'0',transform:`translate(calc(-50% + ${toolbarPos.x}px), ${toolbarPos.y}px)`,touchAction:'none'}}>
<div className={`toolbar-flipper ${isPatrolActive&&!isToolbarActive&&!showSquadMenu&&!showSleepMenu&&!showPatrolMenu?'flipped':''}`}>
<div className={`toolbar-front ${isToolbarActive||showSquadMenu||showSleepMenu||showPatrolMenu||isToolbarPinned?'active':''}`}>
<div className="flex items-center"><Tooltip text={isSidebarOpen?t('tt_hide_chat'):t('tt_show_chat')}><button onClick={e=>{e.stopPropagation();setIsSidebarOpen(!isSidebarOpen)}} className={`p-2 rounded-full transition-all ${isSidebarOpen?'bg-indigo-500 text-white':'text-gray-400 hover:text-white'}`}><span className="md:hidden"><ChatIcon width={20} height={20}/></span><span className="hidden md:block"><PanelRightIcon width={20} height={20}/></span></button></Tooltip><div className="hidden md:block w-px h-5 bg-white/10 mx-1"></div></div><Tooltip text={isTheaterMode?t('tt_cinema_exit'):t('tt_cinema_enter')}><button onClick={e=>{e.stopPropagation();toggleTheaterMode()}} className={`flex items-center justify-center p-2 rounded-full transition-all active:scale-90 shrink-0 ${isTheaterMode?'bg-amber-400 text-black shadow-glow':'bg-white/5 text-gray-300 hover:text-white'}`}>{isTheaterMode?<SunIcon width={20} height={20}/>:<MoonIcon width={20} height={20}/>}</button></Tooltip><div className="hidden md:block w-px h-5 bg-white/10 mx-0.5 shrink-0"></div>
{!(isToolbarActive||showSquadMenu||showSleepMenu||showPatrolMenu||isToolbarPinned)?<Tooltip text={t('tt_menu')}><button onClick={(e)=>{e.stopPropagation();if(Date.now()-lastCloseRef.current<2500)return;setIsToolbarActive(true)}} className="text-white/30 w-8 h-8 flex items-center justify-center cursor-pointer hover:text-white/80 animate-pulse"><MenuIcon width={22} height={22}/></button></Tooltip>:(<div className="flex flex-wrap md:flex-nowrap items-center justify-center md:justify-start gap-3 md:gap-2 animate-fade-in w-full md:w-auto"><Tooltip text={isGlobalMuted?t('tt_unmute_all'):t('tt_mute_all')}><button onClick={e=>{e.stopPropagation();setIsGlobalMuted(!isGlobalMuted)}} className={`p-2 rounded-full transition-all ${isGlobalMuted?'bg-red-500 text-white animate-pulse':'text-gray-400 hover:text-white hover:bg-white/10'}`}>{isGlobalMuted?<VolumeXIcon width={20} height={20}/>:<Volume2Icon width={20} height={20}/>}</button></Tooltip><div className="hidden md:block w-px h-5 bg-white/10"></div><Tooltip text={t('tt_pip')}><button onClick={e=>{e.stopPropagation();togglePip()}} className={`p-2 rounded-full transition-all ${pipWindow?'bg-ice text-black animate-pulse':'text-gray-400 hover:text-white hover:bg-white/10'}`}><ExternalLinkIcon width={20} height={20}/></button></Tooltip><div className="hidden md:block w-px h-5 bg-white/10"></div><Tooltip text={t('sleep_title')}><button onClick={e=>{e.stopPropagation();setShowSleepMenu(!showSleepMenu);setShowSquadMenu(false);setShowPatrolMenu(false)}} className={`p-2 rounded-full transition-all ${showSleepMenu?'bg-white text-black':'text-gray-400 hover:text-white hover:bg-white/10'} ${sleepTimer.active?'text-indigo-400 animate-pulse':''}`}><ClockIcon width={20} height={20}/></button></Tooltip><SleepTimerMenu isOpen={showSleepMenu} onClose={()=>setShowSleepMenu(false)} onSetTimer={m=>{if(!m)setSleepTimer({active:false,endTime:null,duration:null});else{setSleepTimer({active:true,endTime:Date.now()+m*60000,duration:m});addToast(`Timer: ${m} min`,'info')}}} activeTimer={sleepTimer.duration} lang={lang}/>
<Tooltip text={t('tt_patrol')}><button onClick={e=>{e.stopPropagation();setShowPatrolMenu(!showPatrolMenu);setShowSleepMenu(false);setShowSquadMenu(false)}} className={`p-2 rounded-full transition-all ${showPatrolMenu?'bg-white text-black':'text-gray-400 hover:text-white hover:bg-white/10'} ${isPatrolActive?'text-green-400 animate-pulse':''}`}><RadarIcon width={20} height={20}/></button></Tooltip>
<PatrolMenu isOpen={showPatrolMenu} onClose={()=>setShowPatrolMenu(false)} isPatrolActive={isPatrolActive} togglePatrol={()=>{const willActivate=!isPatrolActive;setIsPatrolActive(willActivate);setShowPatrolMenu(false);if(willActivate){addToast("Ronda Ativada!","success");setLayoutMode('focus');setIsToolbarActive(false);if(toolbarTimeoutRef.current)clearTimeout(toolbarTimeoutRef.current);lastCloseRef.current=Date.now()}}} patrolDuration={patrolDuration} setPatrolDuration={setPatrolDuration} patrolSwitchChat={patrolSwitchChat} setPatrolSwitchChat={setPatrolSwitchChat} setShowPatrolChatInfo={setShowPatrolChatInfo} lang={lang}/>
<div className="hidden md:block w-px h-5 bg-white/10"></div><Tooltip text={t('layout_auto')}><button onClick={e=>{e.stopPropagation();changeLayout('auto')}} className={`p-2 rounded-full transition-all ${layoutMode==='auto'&&!expandedStreamId?'bg-white text-black':'text-gray-400 hover:text-white hover:bg-white/10'}`}><LayoutIcon width={20} height={20}/></button></Tooltip><Tooltip text={t('layout_grid')}><button onClick={e=>{e.stopPropagation();changeLayout('grid')}} className={`p-2 rounded-full transition-all ${layoutMode==='grid'&&!expandedStreamId?'bg-white text-black':'text-gray-400 hover:text-white hover:bg-white/10'}`}><GridIcon width={20} height={20}/></button></Tooltip><Tooltip text={t('layout_focus')}><button onClick={e=>{e.stopPropagation();changeLayout('focus')}} className={`p-2 rounded-full transition-all ${expandedStreamId?'bg-white text-black':'text-gray-400 hover:text-white hover:bg-white/10'}`}><LayoutTemplateIcon width={20} height={20}/></button></Tooltip><div className="hidden md:block w-px h-5 bg-white/10 mx-0.5"></div><button onClick={e=>{e.stopPropagation();setShowSquadMenu(!showSquadMenu);setShowSleepMenu(false);setShowPatrolMenu(false)}} className={`flex items-center justify-center gap-2 px-3 py-1.5 rounded-full text-xs font-bold transition-all w-full md:w-auto mt-1 md:mt-0 ${showSquadMenu?'bg-accent text-white':'bg-white/5 hover:bg-white/10 text-ice border border-ice/20'}`}><UsersIcon width={16} height={16}/>{t('squads_title')}</button><SquadsMenu isOpen={showSquadMenu} onClose={()=>setShowSquadMenu(false)} squads={squads} currentStreamers={streamers} onSave={n=>{const ns={id:Date.now(),name:n,streams:streamers};setSquads(p=>[...p,ns]);addToast(t('squad_saved'),'success')}} onLoad={s=>{setStreamers(s.streams);if(s.streams.length)setActiveChatTab(s.streams[0].id);setLayoutMode('auto');setExpandedStreamId(null);setShowSquadMenu(false)}} onDelete={id=>{setSquads(p=>p.filter(x=>x.id!==id));addToast(t('squad_deleted'),'info')}} lang={lang}/>
<div className="hidden md:block w-px h-5 bg-white/10"></div>
<Tooltip text={isToolbarPinned ? t('tt_unpin') : t('tt_pin')}><button onClick={e=>{e.stopPropagation();setIsToolbarPinned(!isToolbarPinned);if(isToolbarPinned) setIsToolbarActive(true);}} className={`p-2 rounded-full transition-all ${isToolbarPinned?'text-ice bg-ice/10':'text-gray-500 hover:text-white'}`}>{isToolbarPinned ? <PinIcon width={16} height={16}/> : <PinOffIcon width={16} height={16}/>}</button></Tooltip>
<button onClick={(e)=>{e.stopPropagation();e.nativeEvent.stopImmediatePropagation();lastCloseRef.current=Date.now();setIsToolbarActive(false);setShowSquadMenu(false);setShowSleepMenu(false);setShowPatrolMenu(false)}} className="md:hidden flex items-center justify-center w-full mt-2 py-2 rounded-lg text-red-400 bg-red-500/10 border border-red-500/20 active:bg-red-500/20 transition-all font-bold text-xs gap-2"><XIcon width={16} height={16}/> Fechar Menu</button></div>)}</div>
<div className="toolbar-back"><div className="patrol-timer-badge"><RadarIcon width={20} height={20} className="animate-spin-slow"/><span>{patrolTimeLeft}s</span></div></div></div></div>
<main className={`flex-1 flex flex-col md:flex-row overflow-hidden pt-1 md:pt-1 ${isTheaterMode?'!pt-0 !h-full':''} z-10 relative transition-all duration-700`}><div className="flex-1 relative bg-transparent overflow-hidden flex flex-col min-h-0">{streamers.length===0?<div className="flex-1 flex flex-col items-center justify-center text-center animate-fade-in"><div className="p-8 max-w-md w-full mx-4 opacity-50"><p className="text-gray-500 text-sm mb-6 leading-relaxed mt-20">{t('empty_desc')}</p></div></div>:renderContent()}</div><div ref={sidebarRef} className={`flex flex-col sidebar-glass transition-all ease-[cubic-bezier(0.4,0,0.2,1)] z-30 relative ${isSidebarOpen?'translate-y-0 translate-x-0 opacity-100':(typeof window!=='undefined'&&window.innerWidth<768?'translate-x-full opacity-0':'translate-y-10 md:translate-y-0 md:translate-x-10 opacity-0 overflow-hidden')} ${isResizing ? 'resizing-active' : ''}`} style={{width:typeof window!=='undefined'&&window.innerWidth<768?'min(340px, 85vw)':(isSidebarOpen?`${sidebarWidth}px`:'0px'),height:'100%',transitionDuration:isResizing?'0s':'300ms'}}><div className="hidden md:flex absolute left-0 top-0 bottom-0 w-1.5 hover:w-3 items-center justify-center -ml-1.5 z-50 cursor-col-resize group/resizer" onMouseDown={startResizing} onTouchStart={startResizing}><div className="h-8 w-1 rounded-full bg-white/20 group-hover/resizer:bg-accent/80 transition-colors"></div></div><div className="flex flex-col h-full w-full overflow-hidden"><div className={`transition-all duration-300 ease-in-out overflow-hidden flex flex-col relative group bg-black/40 border-b border-white/5`} style={{height:showMap?`${mapHeight}px`:'0px',transitionDuration:isResizingMap?'0s':'300ms'}}><iframe src="https://rtirl.com/twitch:119611214" className={`w-full h-full border-none grayscale-[30%] invert-[5%] contrast-125 ${isResizingMap||isResizing?'pointer-events-none':''}`} scrolling="no"></iframe><div className="absolute bottom-0 left-0 right-0 p-2 bg-gradient-to-t from-[#09090b] to-transparent pointer-events-none flex justify-between items-end"><span className="text-[10px] font-bold text-ice/80 tracking-widest uppercase mb-1 ml-1 drop-shadow-md">{t('realtime_loc')}</span></div>{showMap&&<div className="absolute bottom-0 left-0 right-0 h-2 flex justify-center items-center -mb-1 z-50 cursor-row-resize group/mapresizer" onMouseDown={startMapResizing} onTouchStart={startMapResizing}><div className="w-8 h-1 rounded-full bg-white/20 group-hover/mapresizer:bg-accent/80 transition-colors"></div></div>}</div>
<div className="flex-1 flex min-h-0 overflow-visible"><div className="w-[60px] flex flex-col items-center bg-[#09090b] border-r border-white/5 py-3 gap-3 shrink-0 z-20 overflow-visible relative"><Tooltip text={showMap?t('hide_btn'):t('map_btn')} className="w-10 h-10" position="left"><button onClick={()=>setShowMap(!showMap)} className={`w-10 h-10 rounded-xl flex items-center justify-center transition-all shadow-lg active:scale-90 ${showMap?'bg-gradient-to-br from-ice to-cyan-600 text-black border-2 border-white/50 ring-2 ring-cyan-500/20':'bg-gradient-to-br from-indigo-600/40 to-cyan-600/40 text-ice border border-ice/40 hover:from-indigo-600 hover:to-cyan-600 hover:text-white hover:shadow-[0_0_15px_rgba(165,243,252,0.4)]'}`}><MapIcon width={20} height={20}/></button></Tooltip><div className="w-8 h-[1px] bg-white/10"></div><div className="flex flex-col gap-3 overflow-y-auto overflow-x-visible scrollbar-hide w-full items-center pb-20">{streamers.map(s=>(<Tooltip key={s.id} text={s.name} className="w-10 h-10 shrink-0" position="left"><button onClick={()=>setActiveChatTab(s.id)} className={`relative w-10 h-10 rounded-full flex items-center justify-center transition-all border-2 overflow-hidden ${activeChatTab===s.id?(s.platform==='twitch'?'border-[#9146ff] bg-[#9146ff]/20 text-white shadow-[0_0_10px_rgba(145,70,255,0.4)]':s.platform==='kick'?'border-[#53fc18] bg-[#53fc18]/20 text-white shadow-[0_0_10px_rgba(83,252,24,0.4)]':s.platform==='youtube'?'border-[#ff0000] bg-[#ff0000]/20 text-white shadow-[0_0_10px_rgba(255,0,0,0.4)]':'border-white text-white'):'border-transparent bg-white/5 text-gray-400 hover:text-white hover:bg-white/10'}`}>{activeChatTab===s.id&&<div className="absolute -left-3 top-1/2 -translate-y-1/2 w-1 h-5 bg-white rounded-r-full z-10"></div>}{s.avatar?<img src={s.avatar} alt={s.name} className="w-full h-full object-cover rounded-full"/>:<span className="font-bold text-xs uppercase">{s.name.substring(0,2)}</span>}<div className="absolute -bottom-1 -right-1 bg-[#121215] rounded-full p-[2px] z-10"><div className={`w-3 h-3 rounded-full flex items-center justify-center text-[6px] ${getPlatformColor(s.platform)}`}>{getPlatformIcon(s.platform)}</div></div></button></Tooltip>))}</div><div className="mt-auto absolute bottom-4 left-0 right-0 flex justify-center bg-transparent z-30"><Tooltip text="Split Chat" className="w-10 h-10" position="left"><button onClick={()=>setSecondaryChatTab(secondaryChatTab?null:streamers.find(s=>s.id!==activeChatTab)?.id||activeChatTab)} className={`w-10 h-10 rounded-xl flex items-center justify-center transition-all ${secondaryChatTab?'bg-accent text-white shadow-glow':'text-gray-500 hover:text-white hover:bg-white/5'}`}><SplitIcon width={18} height={18}/></button></Tooltip></div></div><div className="flex-1 flex-col bg-[#0b0e11] min-w-0 relative flex overflow-hidden"><div className="md:hidden bg-indigo-600 text-white text-[10px] font-bold px-3 py-1 flex items-center justify-between shadow-lg z-30 shrink-0"><span>💡 Dica: Chat externo economiza bateria</span><button onClick={()=>{const s=streamers.find(st=>st.id===activeChatTab);if(s){if(s.platform==='twitch')window.open(`https://www.twitch.tv/popout/${s.name}/chat`,`c-${s.name}`,"width=400,height=600");else if(s.platform==='kick')window.open(`https://kick.com/popout/${s.name}/chat`,`c-${s.name}`,"width=400,height=600");else window.open(`https://www.youtube.com/live_chat?v=${s.name}`,`c-${s.name}`,"width=400,height=600")}}} className="bg-white text-indigo-600 px-2 py-0.5 rounded uppercase tracking-wider hover:bg-indigo-50 flex items-center gap-1"><PopoutIcon width={10} height={10}/> Abrir Janela</button></div><div onContextMenu={e=>e.preventDefault()} className="flex-1 flex flex-col min-h-0 bg-[#09090b] overflow-hidden transition-opacity duration-500 ease-out md:opacity-80 md:hover:opacity-100">{[activeChatTab,secondaryChatTab].filter(Boolean).map((tid,idx)=>{const s=streamers.find(st=>st.id===tid);if(!s)return null;const isSec=idx===1;return <div key={isSec?'sec':'pri'} className={`flex-1 relative flex flex-col ${isSec?'border-t border-white/10':''}`}>{isSec?<div className="h-8 bg-surface/80 border-b border-white/5 flex items-center px-2 gap-2"><span className="text-[10px] font-bold text-accent uppercase">Chat 2</span><select className="bg-transparent text-xs text-white outline-none flex-1" value={secondaryChatTab} onChange={e=>setSecondaryChatTab(e.target.value)}>{streamers.map(st=><option key={st.id} value={st.id} className="text-black">{st.name}</option>)}</select><button onClick={()=>setSecondaryChatTab(null)} className="ml-auto text-gray-500 hover:text-white">✕</button></div>:<div className="h-9 bg-[#121215] border-b border-white/5 flex items-center justify-between px-3 shrink-0 z-20 shadow-sm"><div className="flex items-center gap-2"><div className={`flex items-center justify-center w-5 h-5 rounded bg-white/5 ${getPlatformColor(s.platform)}`}>{getPlatformIcon(s.platform)}</div><span className="text-xs font-bold text-white tracking-tight">{s.name}</span><span className="text-[9px] uppercase tracking-widest text-gray-500 border border-white/10 px-1.5 rounded bg-white/5">{s.platform} chat</span></div><div className="flex items-center gap-1"><button onClick={()=>setChatRefreshTriggers(p=>({...p,[s.id]:Date.now()}))} className="p-1.5 text-gray-500 hover:text-ice hover:bg-white/5 rounded transition-colors"><RefreshCwIcon width={12} height={12}/></button><button onClick={()=>{if(s.platform==='twitch')window.open(`https://www.twitch.tv/popout/${s.name}/chat`,`c-${s.name}`,"width=400,height=600");else if(s.platform==='kick')window.open(`https://kick.com/popout/${s.name}/chat`,`c-${s.name}`,"width=400,height=600");else window.open(`https://www.youtube.com/live_chat?v=${s.name}`,`c-${s.name}`,"width=400,height=600")}} className="p-1.5 text-gray-500 hover:text-ice hover:bg-white/5 rounded transition-colors"><ExternalLinkIcon width={12} height={12}/></button><button onClick={()=>setIsSidebarOpen(false)} className="md:hidden ml-2 flex items-center justify-center w-8 h-8 text-gray-400 hover:text-white bg-white/5 border border-white/5 rounded active:bg-white/10"><ChevronDownIcon/></button></div></div>}<div className="flex-1 relative">{s.platform==='kick'?<KickChatEmbed key={chatRefreshTriggers[s.id]||'init'} streamName={s.name} isResizing={isResizing} idSuffix={isSec?'-sec':'-pri'}/>:s.platform==='youtube'?<div className="w-full h-full flex items-center justify-center text-gray-500 text-xs">Chat YT N/A</div>:<iframe key={chatRefreshTriggers[s.id]||'init'} src={`https://www.twitch.tv/embed/${s.name}/chat?parent=${hostname}&parent=localhost&darkpopout`} className="w-full h-full border-0"/>}</div></div>})}</div></div></div></div></div></main></div>);};ReactDOM.createRoot(document.getElementById('root')).render(<App/>);</script><script id="security-module">(function(){const observer=new MutationObserver(function(mutations){mutations.forEach(function(mutation){mutation.removedNodes.forEach(function(node){if(node.id==='security-module'||node.nodeName==='BODY'){window.location.reload()}})})});observer.observe(document.documentElement,{childList:true,subtree:true});document.addEventListener('contextmenu',function(e){e.preventDefault();e.stopPropagation();return false},true);document.onkeydown=function(e){if(e.keyCode==123)return false;if(e.ctrlKey&&e.shiftKey&&(e.keyCode==73||e.keyCode==74||e.keyCode==67))return false;if(e.ctrlKey&&(e.keyCode==85||e.keyCode==83||e.keyCode==80))return false;if(e.metaKey&&e.altKey&&e.keyCode==73)return false};setInterval(function(){var t0=Date.now();(function(){debugger})();var t1=Date.now();if(t1-t0>100){document.body.innerHTML='';window.location.replace("about:blank")}},500);var threshold=160;window.addEventListener('resize',function(){if(window.outerWidth-window.innerWidth>threshold||window.outerHeight-window.innerHeight>threshold){}});var consoleStyle=["color: #ff0000","font-size: 50px","font-weight: 900","text-shadow: 2px 2px #000","background: #000","padding: 40px","border: 5px solid red"].join(";");console.clear();setTimeout(function(){console.log("%c⛔ PARE IMEDIATAMENTE!",consoleStyle);console.log("%cEste código é monitorado. Qualquer cópia não autorizada será reportada automaticamente.\nIP Logged & Traced.","color:white;font-size:18px;background:#111;padding:10px;")},1000)})()</script></body></html>
